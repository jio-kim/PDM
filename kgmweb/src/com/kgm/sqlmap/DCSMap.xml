<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.kgm.mapper.DCSMapper">

	<update id="updateDCSStatus" parameterType="java.util.HashMap">
		UPDATE INFODBA.PS7_DESIGNCONCEPTREVISION_0
			SET PS7_DCS_STATUS = 'Completed'
			WHERE
				PUID = #{puid}
	</update>
	
	<update id="refreshTCObject">
		UPDATE INFODBA.PPOM_OBJECT
			SET PTIMESTAMP = DECODE(SUBSTR(PTIMESTAMP, LENGTH(PTIMESTAMP)), 'X', SUBSTR(PTIMESTAMP, 1, LENGTH(PTIMESTAMP) - 1) || 'Z', SUBSTR(PTIMESTAMP, 1, LENGTH(PTIMESTAMP) - 1) || 'X')
			WHERE PUID = #{puid}
	</update>
	
	<update id="refreshTCTimeStamp">
		MERGE INTO INFODBA.POM_TIMESTAMP A
		USING (SELECT PUID TID, PTIMESTAMP, PLSD FROM INFODBA.PPOM_OBJECT WHERE PUID = #{puid}) B
		ON (A.PUID = B.TID)
		WHEN MATCHED THEN
		UPDATE
		SET A.PTIMESTAMP = DECODE(SUBSTR(A.PTIMESTAMP, LENGTH(A.PTIMESTAMP)), 'X', SUBSTR(A.PTIMESTAMP, 1, LENGTH(A.PTIMESTAMP) - 1) || 'Z', SUBSTR(A.PTIMESTAMP, 1, LENGTH(A.PTIMESTAMP) - 1) || 'X')
		WHEN NOT MATCHED THEN
		INSERT (PUID, PTIMESTAMP, PDBTIMESTAMP, PDELETED)
		VALUES (B.TID,  B.PTIMESTAMP, B.PLSD, 1)
   </update>
   
   <!-- [20161011][taeku.jeong] ORA-01461 LONG 값은 LONG 열에 삽입할 때만 바인드할 수 있습니다. 오류 수정 -->
   <update id="sendMail" statementType="CALLABLE">
        {call CALS.MAILSEND@LINK_001_VNET(
	        	#{the_sysid, jdbcType=VARCHAR}, 
	        	#{the_sabun, jdbcType=VARCHAR}, 
	        	#{the_title, jdbcType=VARCHAR}, 
	        	#{the_remark, jdbcType=VARCHAR}, 
	        	#{the_tsabun, jdbcType=VARCHAR}
        	)}
   </update>

   <!-- SYMC 인트라넷을 통한 메일 발송 (through EAI) -->
   <!-- [20160921][ymjang] ORA-01461 LONG 값은 LONG 열에 삽입할 때만 바인드할 수 있습니다. 오류 수정 -->
   <!-- [20170213][taeku.jeong] ORA-01461 LONG 값은 LONG 열에 삽입할 때만 바인드할 수 있습니다. 문자열을 미리 잘라서 전달하도록 수정 -->
   <select id="sendMailEai">
   INSERT INTO IF_USER.IF_EMAIL (SEQ_NO, SYSTEM_ID, FROM_USERS, TITLE, REMARK, TO_USERS, CREATE_DATE ) 
        SELECT
			( SELECT GET_NEXT_MAIL_SEQ() FROM DUAL ) AS SEQ_NO
			, #{the_sysid,jdbcType=VARCHAR,mode=IN} 
			, #{the_sabun,jdbcType=VARCHAR,mode=IN}
			, #{the_title,jdbcType=VARCHAR,mode=IN}
			, #{the_remark,jdbcType=VARCHAR,mode=IN}
			, #{the_tsabun,jdbcType=VARCHAR,mode=IN}
			, SYSDATE
          FROM DUAL
   </select>

	<select id="getDCSList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT IR.PUID
	     , I.PITEM_ID AS DOC_NO
	     , IR.PITEM_REVISION_ID AS REVISION_NO
	     , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	     , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	     , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	     , ( SELECT MAX(V.TEAM_NAME)
	           FROM INFODBA.PGROUP G1
	              , TEAM_HISTORY V
	          WHERE V.TEAM_CODE = G1.PDESCRIPTION
	            AND G1.PUID = G.PUID ) AS OWNING_GROUP
	     , U.PUSER_NAME AS OWNING_USER
	     , TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYY/MM/DD') AS RELEASE_DATE
	     , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_SECRET, 'S7_SECRET') AS SECRET
	     , DECODE(DCSIR.PS7_FMEA, '1', 'Y', '') AS FMEA
	     , DECODE(DCSIR.PS7_PRODUCT_SPEC, '1', 'Y', '') AS PRODUCT_SPEC
	     , DECODE(DCSIR.PS7_FUNCTION_SAFETY, '1', 'Y', '') AS FUNCTION_SAFETY
	  FROM INFODBA.PITEM I
	     , INFODBA.PITEMREVISION IR
	     , INFODBA.PWORKSPACEOBJECT PWO
	     , INFODBA.PPOM_APPLICATION_OBJECT PAO
	     , INFODBA.PS7_DESIGNCONCEPTREVISION DCSIR
	     , INFODBA.PS7_DESIGNCONCEPT DCSI
	     , INFODBA.PPOM_USER U
	     , INFODBA.PPOM_GROUP G
	 WHERE DCSI.PUID = I.PUID
	   AND DCSIR.PUID = IR.PUID
	   AND IR.RITEMS_TAGU = I.PUID
	   AND U.PUID = PAO.ROWNING_USERU
   	   AND G.PUID = PAO.ROWNING_GROUPU
   	   AND PAO.PUID = IR.PUID
	   AND PWO.PUID = IR.PUID
	   AND PWO.POBJECT_TYPE IN ('S7_DesignConceptRevision') 
	   AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
	                                  FROM INFODBA.PITEM I1
	                                     , INFODBA.PITEMREVISION IR1
	                                 WHERE IR1.RITEMS_TAGU = I1.PUID
	                                   AND I1.PUID = I.PUID
	                               )
	]]>
	<if test="DCS_NO != null and DCS_NO != ''">
	   AND I.PITEM_ID LIKE #{DCS_NO,jdbcType=VARCHAR}
 	</if>
	<if test="PS7_DCS_STATUS != null and PS7_DCS_STATUS != ''">
	   AND DCSIR.PS7_DCS_STATUS = #{PS7_DCS_STATUS,jdbcType=VARCHAR}
 	</if>
	<if test="PS7_PROJECT_CODE != null and PS7_PROJECT_CODE != ''">
	   AND DCSI.PS7_PROJECT_CODE = #{PS7_PROJECT_CODE,jdbcType=VARCHAR}
 	</if>
	<if test="SYSTEM_CODES != null">
	   AND DCSI.PS7_SYSTEM_CODE IN
	   <foreach item="item" index="index" collection="SYSTEM_CODES" open="(" separator="," close=")" >
			#{item, jdbcType=VARCHAR}
	   </foreach>   
 	</if>
	<if test="SUB_SYSTEM_CODES != null">
	   AND EXISTS ( SELECT 'X'
	                  FROM INFODBA.PS7_SUB_SYSTEM_CODE
	                 WHERE PUID = DCSIR.PUID
	                   AND PVAL_0 IN
					   <foreach item="item" index="index" collection="SUB_SYSTEM_CODES" open="(" separator="," close=")" >
							#{item, jdbcType=VARCHAR}
					   </foreach>   
	               )
 	</if>
	<if test="PS7_REL_REGULATIONS != null and PS7_REL_REGULATIONS != ''">
	   AND DCSIR.PS7_REL_REGULATIONS LIKE #{PS7_REL_REGULATIONS,jdbcType=VARCHAR}
 	</if>   
	<if test="ROWNING_USERS != null">
	   AND U.PUSER_NAME IN
	   <foreach item="item" index="index" collection="ROWNING_USERS" open="(" separator="," close=")" >
			#{item, jdbcType=VARCHAR}
	   </foreach>   
 	</if>
	<if test="ROWNING_GROUPS != null">
	   AND G.PNAME IN
	   <foreach item="item" index="index" collection="ROWNING_GROUPS" open="(" separator="," close=")" >
			#{item, jdbcType=VARCHAR}
	   </foreach>   
 	</if>
	<if test="JOINT_WRITERS != null">
	   AND EXISTS ( SELECT 'X'
	                  FROM INFODBA.PS7_JOINT_WRITER J1
	                     , INFODBA.PPOM_MEMBER M1
	                     , INFODBA.PPOM_USER U1
	                 WHERE U1.PUSER_NAME IN 
						   <foreach item="item" index="index" collection="JOINT_WRITERS" open="(" separator="," close=")" >
								#{item, jdbcType=VARCHAR}
						   </foreach>
	                   AND U1.PUID = M1.RUSERU
	                   AND M1.PUID = J1.PVALU_0
	                   AND J1.PUID = DCSIR.PUID )
 	</if>
	<if test="CONSULTATION_DEPARTMENTS != null">
	   AND EXISTS ( SELECT 'X'
	                  FROM TEAM_HISTORY H21, TEAM_HISTORY H22
                         , INFODBA.PS7_CONSULTATION_DEPT_CODE C1
                     WHERE C1.PUID = DCSIR.PUID 
                       AND C1.PVAL_0 = H21.TEAM_CODE
                       AND H21.TEAM_NAME = H22.TEAM_NAME
                       AND H22.TEAM_CODE IN 
						   <foreach item="item" index="index" collection="CONSULTATION_DEPARTMENTS" open="(" separator="," close=")" >
								#{item, jdbcType=VARCHAR}
						   </foreach>
	               )
 	</if>
 	<!--
	<if test="CONSULTATION_DEPARTMENTS != null">
	   AND EXISTS ( SELECT 'X'
	                  FROM INFODBA.PS7_CONSULTATION_DEPARTMENT C1
	                     , INFODBA.PPOM_GROUP G1
	                     , INFODBA.PGROUP PG1
	                 WHERE PG1.PUID = G1.PUID
	                   AND G1.PUID = C1.PVALU_0
	                   AND C1.PUID = DCSIR.PUID 
	                   AND PG1.PDESCRIPTION IN
						   <foreach item="item" index="index" collection="CONSULTATION_DEPARTMENTS" open="(" separator="," close=")" >
								#{item, jdbcType=VARCHAR}
						   </foreach>
	               )
 	</if>
 	-->
	<if test="REFERENCE_DEPARTMENTS != null">
	   AND EXISTS ( SELECT 'X'
	                  FROM TEAM_HISTORY H21, TEAM_HISTORY H22
                         , INFODBA.PS7_REFERENCE_DEPT_CODE C1
                     WHERE C1.PUID = DCSIR.PUID 
                       AND C1.PVAL_0 = H21.TEAM_CODE
                       AND H21.TEAM_NAME = H22.TEAM_NAME
                       AND H22.TEAM_CODE IN 
						   <foreach item="item" index="index" collection="REFERENCE_DEPARTMENTS" open="(" separator="," close=")" >
								#{item, jdbcType=VARCHAR}
						   </foreach>
	               )
 	</if>
 	<!--
	<if test="REFERENCE_DEPARTMENTS != null">
	   AND EXISTS ( SELECT 'X'
                      FROM INFODBA.PS7_REFERENCE_DEPARTMENT R1
                         , INFODBA.PPOM_GROUP G1
                         , INFODBA.PGROUP PG1
                     WHERE PG1.PUID = G1.PUID
                       AND G1.PUID = R1.PVALU_0
                       AND R1.PUID = DCSIR.PUID
                       AND PG1.PDESCRIPTION IN
						   <foreach item="item" index="index" collection="REFERENCE_DEPARTMENTS" open="(" separator="," close=")" >
								#{item, jdbcType=VARCHAR}
						   </foreach>
	              )
 	</if>
 	-->
	<if test="PDATE_RELEASED_FROM != null and PDATE_RELEASED_FROM != ''">
	   AND TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYYMMDD') >= #{PDATE_RELEASED_FROM,jdbcType=VARCHAR}
 	</if>
	<if test="PDATE_RELEASED_TO != null and PDATE_RELEASED_TO != ''">
	<![CDATA[
	   AND TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYYMMDD') <= #{PDATE_RELEASED_TO,jdbcType=VARCHAR}
	]]>
 	</if>
	<if test="PS7_FMEA != null and PS7_FMEA != ''">
	   AND DECODE(DCSIR.PS7_FMEA, '1', 'Y', 'N') = #{PS7_FMEA,jdbcType=VARCHAR}
 	</if>
	<if test="PS7_PRODUCT_SPEC != null and PS7_PRODUCT_SPEC != ''">
	   AND DECODE(DCSIR.PS7_PRODUCT_SPEC, '1', 'Y', 'N') = #{PS7_PRODUCT_SPEC,jdbcType=VARCHAR}
 	</if>
	<if test="PS7_FUNCTION_SAFETY != null and PS7_FUNCTION_SAFETY != ''">
	   AND DECODE(DCSIR.PS7_FUNCTION_SAFETY, '1', 'Y', 'N') = #{PS7_FUNCTION_SAFETY,jdbcType=VARCHAR}
 	</if>
	<![CDATA[
	ORDER BY I.PITEM_ID
	]]>
	</select>
	
	<select id="getPSCList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT IR.PUID
	     , I.PITEM_ID AS DOC_NO
	     , IR.PITEM_REVISION_ID AS REVISION_NO
	     , SCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	     , SCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	     , HBOM_CM_PACKAGE_TEST.GET_LOV_DESCRIPTION(SCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	     , ( SELECT MAX(V.TEAM_NAME)
	          FROM INFODBA.PGROUP G1
	             , TEAM_HISTORY V
	         WHERE V.TEAM_CODE = G1.PDESCRIPTION
	           AND G1.PUID = G.PUID ) AS OWNING_GROUP
	     , U.PUSER_NAME AS OWNING_USER
	     , TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYY/MMD/D') AS RELEASE_DATE
	     , '' AS SECRET
	     , '' AS FMEA
	     , '' AS PRODUCT_SPEC
	     , '' AS FUNCTION_SAFETY
	  FROM INFODBA.PITEM I
	     , INFODBA.PITEMREVISION IR
	     , INFODBA.PWORKSPACEOBJECT PWO
	     , INFODBA.PPOM_APPLICATION_OBJECT PAO
	     , INFODBA.PS7_SYSTEMCONCEPTREVISION SCSIR
	     , INFODBA.PS7_SYSTEMCONCEPT SCSI
	     , INFODBA.PPOM_USER U
	     , INFODBA.PPOM_GROUP G
	 WHERE SCSI.PUID = I.PUID
	   AND SCSIR.PUID = IR.PUID
	   AND IR.RITEMS_TAGU = I.PUID
	   AND U.PUID = PAO.ROWNING_USERU
   	   AND G.PUID = PAO.ROWNING_GROUPU
   	   AND PAO.PUID = IR.PUID
	   AND PWO.PUID = IR.PUID
	   AND PWO.POBJECT_TYPE IN ('S7_SystemConceptRevision') 
	   AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
	                                  FROM INFODBA.PITEM I1
	                                     , INFODBA.PITEMREVISION IR1
	                                 WHERE IR1.RITEMS_TAGU = I1.PUID
	                                   AND I1.PUID = I.PUID
	                               )
	]]>
	<if test="DCS_NO != null and DCS_NO != ''">
	   AND I.PITEM_ID LIKE #{DCS_NO,jdbcType=VARCHAR}
 	</if>
	<if test="PS7_DCS_STATUS != null and PS7_DCS_STATUS != ''">
	   AND SCSIR.PS7_PSC_STATUS = #{PS7_DCS_STATUS,jdbcType=VARCHAR}
 	</if>
	<if test="PS7_PROJECT_CODE != null and PS7_PROJECT_CODE != ''">
	   AND SCSI.PS7_PROJECT_CODE = #{PS7_PROJECT_CODE,jdbcType=VARCHAR}
 	</if>
	<if test="SYSTEM_CODES != null">
	   AND SCSI.PS7_SYSTEM_CODE IN
	   <foreach item="item" index="index" collection="SYSTEM_CODES" open="(" separator="," close=")" >
			#{item, jdbcType=VARCHAR}
	   </foreach>   
 	</if>
	<if test="ROWNING_USERS != null">
	   AND U.PUSER_NAME IN
	   <foreach item="item" index="index" collection="ROWNING_USERS" open="(" separator="," close=")" >
			#{item, jdbcType=VARCHAR}
	   </foreach>   
 	</if>
	<if test="ROWNING_GROUPS != null">
	   AND G.PNAME IN
	   <foreach item="item" index="index" collection="ROWNING_GROUPS" open="(" separator="," close=")" >
			#{item, jdbcType=VARCHAR}
	   </foreach>   
 	</if>
	<if test="JOINT_WRITERS != null">
	   AND EXISTS ( SELECT 'X'
	                  FROM INFODBA.PS7_JOINT_WRITER J1
	                     , INFODBA.PPOM_MEMBER M1
	                     , INFODBA.PPOM_USER U1
	                 WHERE U1.PUSER_NAME IN 
						   <foreach item="item" index="index" collection="JOINT_WRITERS" open="(" separator="," close=")" >
								#{item, jdbcType=VARCHAR}
						   </foreach>
	                   AND U1.PUID = M1.RUSERU
	                   AND M1.PUID = J1.PVALU_0
	                   AND J1.PUID = SCSIR.PUID )
 	</if>
	<if test="PDATE_RELEASED_FROM != null and PDATE_RELEASED_FROM != ''">
	   AND TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYYMMDD') >= #{PDATE_RELEASED_FROM,jdbcType=VARCHAR}
 	</if>
	<if test="PDATE_RELEASED_TO != null and PDATE_RELEASED_TO != ''">
	<![CDATA[
	   AND TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYYMMDD') <= #{PDATE_RELEASED_TO,jdbcType=VARCHAR}
	]]>
 	</if>
	<![CDATA[
	ORDER BY I.PITEM_ID
	]]>
	</select>
	
	<select id="getDCSInWorkCount" resultType="int">
	<![CDATA[
	SELECT COUNT(I.PITEM_ID)
	  FROM INFODBA.PITEM I
	     , INFODBA.PITEMREVISION IR
	     , INFODBA.PWORKSPACEOBJECT PWO
	     , INFODBA.PPOM_APPLICATION_OBJECT PAO
	     , INFODBA.PS7_DESIGNCONCEPTREVISION DCSIR
	     , INFODBA.PPOM_USER U
	 WHERE DCSIR.PUID = IR.PUID
	   AND IR.RITEMS_TAGU = I.PUID
	   AND U.PUID = PAO.ROWNING_USERU
	   AND PAO.PUID = IR.PUID
	   AND PWO.PUID = IR.PUID
	   AND PWO.POBJECT_TYPE IN ('S7_DesignConceptRevision') 
	   AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
	                                  FROM INFODBA.PITEM I1
	                                     , INFODBA.PITEMREVISION IR1
	                                 WHERE IR1.RITEMS_TAGU = I1.PUID
	                                   AND I1.PUID = I.PUID
	                               )
	   AND DCSIR.PS7_DCS_STATUS IN ('In Work', 'Reject')
	   AND U.PUSER_ID = #{ROWNING_USER, jdbcType=VARCHAR}
	]]>
	</select>

	<select id="getPSCInWorkCount" resultType="int">
	<![CDATA[
	SELECT COUNT(I.PITEM_ID)
	  FROM INFODBA.PITEM I
	     , INFODBA.PITEMREVISION IR
	     , INFODBA.PWORKSPACEOBJECT PWO
	     , INFODBA.PPOM_APPLICATION_OBJECT PAO
	     , INFODBA.PS7_SYSTEMCONCEPTREVISION SCSIR
	     , INFODBA.PPOM_USER U
	 WHERE SCSIR.PUID = IR.PUID
	   AND IR.RITEMS_TAGU = I.PUID
	   AND U.PUID = PAO.ROWNING_USERU
	   AND PAO.PUID = IR.PUID
	   AND PWO.PUID = IR.PUID
	   AND PWO.POBJECT_TYPE IN ('S7_SystemConceptRevision') 
	   AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
	                                  FROM INFODBA.PITEM I1
	                                     , INFODBA.PITEMREVISION IR1
	                                 WHERE IR1.RITEMS_TAGU = I1.PUID
	                                   AND I1.PUID = I.PUID
	                               )
	   AND SCSIR.PS7_PSC_STATUS IN ('In Work', 'Reject')
	   AND U.PUSER_ID = #{ROWNING_USER, jdbcType=VARCHAR}	
	]]>
	</select>
		
	<!-- 처리대기리스트 -->	
	<select id="getStandbyList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN, X.PROJECT_CODE
	     , X.SYSTEM_CODE, X.SYSTEM_NAME
	     , X.CREATE_DATE, X.STATUS
	     , X.TASK_PUID
	  FROM (
	        SELECT I.PITEM_ID AS DOCUMENT_NO
	             , IR.PITEM_REVISION_ID AS REVISION_NO
	             , CASE WHEN INSTR(PPJOBW.POBJECT_NAME, '작성부서') > 0 THEN '작성'
	                    WHEN INSTR(PPJOBW.POBJECT_NAME, '협의부서') > 0 THEN '협의' 
	                    WHEN INSTR(PPJOBW.POBJECT_NAME, '참조부서') > 0 THEN '참조'
	                    ELSE ''
	               END AS GUBUN
	             , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	             , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	             , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	             , TO_CHAR(IRPAO.PCREATION_DATE + 9/24, 'YYYY/MM/DD') AS CREATE_DATE 
	             , DCSIR.PS7_DCS_STATUS
	             , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_DCS_STATUS, 'S7_DCS_STATUS') AS STATUS
	             , PPET.PUID AS TASK_PUID
	          FROM INFODBA.PITEM I
	             , INFODBA.PITEMREVISION IR
	             , INFODBA.PS7_DESIGNCONCEPTREVISION DCSIR
	             , INFODBA.PS7_DESIGNCONCEPT DCSI
	             , INFODBA.PWORKSPACEOBJECT IRW
	             , INFODBA.PPOM_APPLICATION_OBJECT IRPAO
	             , INFODBA.PEPMJOB PPJOB
	             , INFODBA.PWORKSPACEOBJECT PPJOBW
	             , INFODBA.PATTACHMENTS PPATC
	             , INFODBA.PWORKSPACEOBJECT PPETW
	             , INFODBA.PEPMTASK PPET
	             , INFODBA.PEPMTASKTEMPLATE PPETT
	             , INFODBA.PEPMTASK PET
	             , INFODBA.PEPMTASKTEMPLATE PETT
	             , INFODBA.PEPMTASK CET
	             , INFODBA.PEPMTASKTEMPLATE CETT
	             , INFODBA.PATTACHMENTS CATT
	             , INFODBA.PSIGNOFF SO
	             , INFODBA.PPOM_MEMBER PM
	             , INFODBA.PPOM_USER PU
	             , INFODBA.PPOM_GROUP PG
	         WHERE DCSI.PUID = I.PUID
	           AND DCSIR.PUID = IR.PUID
	           AND I.PUID = IR.RITEMS_TAGU
	           AND IRPAO.PUID = IR.PUID
	           AND IRW.PUID = IR.PUID
	           AND IR.PUID = PPATC.PVALU_0
	           AND PPJOBW.PUID = PPJOB.PUID
	           AND PPJOB.PUID = PPET.RPARENT_PROCESSU
	           AND PPATC.PUID = PPET.PUID
	           AND PPETW.PUID = PPET.PUID
	           AND PPETT.PUID = PPET.RTASK_TEMPLATEU
	           AND PPET.PUID = PET.RPARENT_TASKU
	           AND PETT.PUID = PET.RTASK_TEMPLATEU
	           AND PET.PUID = CET.RPARENT_TASKU
	           AND CETT.PUID = CET.RTASK_TEMPLATEU
	           AND CET.PUID = CATT.PUID
	           AND CATT.PVALU_0 = SO.PUID
	           AND SO.RGROUP_MEMBERU = PM.PUID
	           AND PM.RUSERU = PU.PUID
	           AND PM.RGROUPU = PG.PUID
	           AND PU.PUSER_ID = #{USER_ID, jdbcType=VARCHAR}
	           AND CETT.PTEMPLATE_NAME = 'perform-signoffs'
	           AND PPETW.POBJECT_NAME LIKE 'SYMC_DCS%'
	           AND CET.PTASK_RESULT = 'Unset'
	       ) X
	   WHERE (#{GUBUN, jdbcType=VARCHAR} = 'ALL' OR X.GUBUN = #{GUBUN, jdbcType=VARCHAR})
	     AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR X.PROJECT_CODE = #{PROJECT_CODE, jdbcType=VARCHAR})
	     AND (#{SYSTEM_NAME, jdbcType=VARCHAR} IS NULL OR X.SYSTEM_NAME LIKE #{SYSTEM_NAME, jdbcType=VARCHAR})
	     AND (#{STATUS, jdbcType=VARCHAR} IS NULL OR X.PS7_DCS_STATUS = #{STATUS, jdbcType=VARCHAR})
	     AND (#{SEARHSCOPE, jdbcType=VARCHAR} = 'ALL' OR #{SEARHSCOPE, jdbcType=VARCHAR} = 'Design Concept') 
   UNION ALL
	SELECT X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN, X.PROJECT_CODE
	     , X.SYSTEM_CODE, X.SYSTEM_NAME
	     , X.CREATE_DATE, X.STATUS
	     , X.TASK_PUID
	  FROM (
	        SELECT I.PITEM_ID AS DOCUMENT_NO
	             , IR.PITEM_REVISION_ID AS REVISION_NO
	             , '작성' AS GUBUN
	             , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	             , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	             , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	             , TO_CHAR(IRPAO.PCREATION_DATE + 9/24, 'YYYY/MM/DD') AS CREATE_DATE 
	             , DCSIR.PS7_PSC_STATUS
	             , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_PSC_STATUS, 'S7_PSC_STATUS') AS STATUS
	             , PPET.PUID AS TASK_PUID
	          FROM INFODBA.PITEM I
	             , INFODBA.PITEMREVISION IR
	             , INFODBA.PS7_SYSTEMCONCEPTREVISION DCSIR
	             , INFODBA.PS7_SYSTEMCONCEPT DCSI
	             , INFODBA.PWORKSPACEOBJECT IRW
	             , INFODBA.PPOM_APPLICATION_OBJECT IRPAO
	             , INFODBA.PEPMJOB PPJOB
	             , INFODBA.PWORKSPACEOBJECT PPJOBW
	             , INFODBA.PATTACHMENTS PPATC
	             , INFODBA.PWORKSPACEOBJECT PPETW
	             , INFODBA.PEPMTASK PPET
	             , INFODBA.PEPMTASKTEMPLATE PPETT
	             , INFODBA.PEPMTASK PET
	             , INFODBA.PEPMTASKTEMPLATE PETT
	             , INFODBA.PEPMTASK CET
	             , INFODBA.PEPMTASKTEMPLATE CETT
	             , INFODBA.PATTACHMENTS CATT
	             , INFODBA.PSIGNOFF SO
	             , INFODBA.PPOM_MEMBER PM
	             , INFODBA.PPOM_USER PU
	             , INFODBA.PPOM_GROUP PG
	         WHERE DCSI.PUID = I.PUID
	           AND DCSIR.PUID = IR.PUID
	           AND I.PUID = IR.RITEMS_TAGU
	           AND IRPAO.PUID = IR.PUID
	           AND IRW.PUID = IR.PUID
	           AND IR.PUID = PPATC.PVALU_0
	           AND PPJOBW.PUID = PPJOB.PUID
	           AND PPJOB.PUID = PPET.RPARENT_PROCESSU
	           AND PPATC.PUID = PPET.PUID
	           AND PPETW.PUID = PPET.PUID
	           AND PPETT.PUID = PPET.RTASK_TEMPLATEU
	           AND PPET.PUID = PET.RPARENT_TASKU
	           AND PETT.PUID = PET.RTASK_TEMPLATEU
	           AND PET.PUID = CET.RPARENT_TASKU
	           AND CETT.PUID = CET.RTASK_TEMPLATEU
	           AND CET.PUID = CATT.PUID
	           AND CATT.PVALU_0 = SO.PUID
	           AND SO.RGROUP_MEMBERU = PM.PUID
	           AND PM.RUSERU = PU.PUID
	           AND PM.RGROUPU = PG.PUID
	           AND PU.PUSER_ID = #{USER_ID, jdbcType=VARCHAR}
	           AND CETT.PTEMPLATE_NAME = 'perform-signoffs'
	           AND PPETW.POBJECT_NAME LIKE 'SYMC_PSC%'
	           AND CET.PTASK_RESULT = 'Unset'
	       ) X
	   WHERE (#{GUBUN, jdbcType=VARCHAR} = 'ALL' OR X.GUBUN = #{GUBUN, jdbcType=VARCHAR})
	     AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR X.PROJECT_CODE = #{PROJECT_CODE, jdbcType=VARCHAR})
	     AND (#{SYSTEM_NAME, jdbcType=VARCHAR} IS NULL OR X.SYSTEM_NAME LIKE #{SYSTEM_NAME, jdbcType=VARCHAR})
	     AND (#{STATUS, jdbcType=VARCHAR} IS NULL OR X.PS7_PSC_STATUS = #{STATUS, jdbcType=VARCHAR})
	     AND (#{SEARHSCOPE, jdbcType=VARCHAR} = 'ALL' OR #{SEARHSCOPE, jdbcType=VARCHAR} = 'System Concept') 
	ORDER BY 1, 2, 3
	]]>
	</select>

	<!-- 처리대기리스트 - 타스크별 결재 이력 -->
	<select id="getSignOffbyTaskList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT PG.PNAME, G.PDESCRIPTION
	     , ( SELECT MAX(TEAM_NAME) FROM TEAM_HISTORY WHERE TEAM_CODE = G.PDESCRIPTION) AS TEAM_NAME
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Team Leader' THEN PU.PUSER_NAME ELSE NULL END) AS TEAM_LEADER
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Team Leader' THEN PU.PUSER_ID ELSE NULL END) AS TEAM_LEADER_ID
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Team Leader' THEN TO_CHAR(SO.PDECISION_DATE+9/24, 'YYYY/MM/DD') ELSE NULL END) AS TEAM_LEADER_DT
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Team Leader' THEN PET.PTASK_RESULT ELSE NULL END) AS TEAM_LEADER_TASK_RESULT
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Sub Team Leader' THEN PU.PUSER_NAME ELSE NULL END) AS SUB_TEAM_LEADER
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Sub Team Leader' THEN PU.PUSER_ID ELSE NULL END) AS SUB_TEAM_LEADER_ID
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Sub Team Leader' THEN TO_CHAR(SO.PDECISION_DATE+9/24, 'YYYY/MM/DD') ELSE NULL END) AS SUB_TEAM_LEADER_DT
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Sub Team Leader' THEN CET.PTASK_RESULT ELSE NULL END) AS SUB_TEAM_LEADER_TASK_RESULT
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Reviewer' THEN PU.PUSER_NAME ELSE NULL END) AS REVIEWER
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Reviewer' THEN PU.PUSER_ID ELSE NULL END) AS REVIEWER_ID
	     , MAX(CASE WHEN PETW.POBJECT_NAME = 'Reviewer' THEN TO_CHAR(SO.PDECISION_DATE+9/24, 'YYYY/MM/DD') ELSE NULL END) AS REVIEWER_DT
	  FROM INFODBA.PEPMTASK PPET
	     , INFODBA.PWORKSPACEOBJECT PPETW
	     , INFODBA.PEPMTASKTEMPLATE PPETT
	     , INFODBA.PEPMTASK PET
	     , INFODBA.PEPMTASKTEMPLATE PETT
	     , INFODBA.PWORKSPACEOBJECT PETW
	     , INFODBA.PEPMTASK CET
	     , INFODBA.PEPMTASKTEMPLATE CETT
	     , INFODBA.PWORKSPACEOBJECT CETW
	     , INFODBA.PATTACHMENTS CATT
	     , INFODBA.PSIGNOFF SO
	     , INFODBA.PPOM_MEMBER PM
	     , INFODBA.PPOM_USER PU
	     , INFODBA.PPOM_GROUP PG
	     , INFODBA.PGROUP G
	 WHERE PPET.PUID = #{TASK_PUID, jdbcType=VARCHAR}
	   AND PPETW.PUID = PPET.PUID
	   AND PPETT.PUID = PPET.RTASK_TEMPLATEU
	   AND PPET.PUID = PET.RPARENT_TASKU
	   AND PETT.PUID = PET.RTASK_TEMPLATEU
	   AND PETW.PUID = PET.PUID
	   AND PET.PUID = CET.RPARENT_TASKU
	   AND CETT.PUID = CET.RTASK_TEMPLATEU
	   AND CETW.PUID = CET.PUID
	   AND CET.PUID = CATT.PUID
	   AND CATT.PVALU_0 = SO.PUID
	   AND SO.RGROUP_MEMBERU = PM.PUID
	   AND PM.RUSERU = PU.PUID
	   AND PM.RGROUPU = PG.PUID
	   AND PG.PUID = G.PUID
  GROUP BY PG.PNAME, G.PDESCRIPTION
	]]>
	</select>
	
	<!-- 진행중 DC 리스트 -->
	<select id="getProcessingList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT I.PITEM_ID AS DOCUMENT_NO
	     , IR.PITEM_REVISION_ID AS REVISION_NO
	     , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	     , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	     , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	     , ( SELECT MAX(V.TEAM_NAME)
	           FROM INFODBA.PGROUP G1
	              , TEAM_HISTORY V
	          WHERE V.TEAM_CODE = G1.PDESCRIPTION
	            AND G1.PUID = PG.PUID ) AS OWNING_GROUP
	     , PU.PUSER_NAME AS OWNING_USER
	     , PU.PUSER_ID AS OWNING_USER_ID
	     , P.PPA10 AS TEL
	     , PG.PNAME AS OWNING_GROUP1
	     , PAO.ROWNING_USERU AS OWNING_USER_PUID
	     , TO_CHAR(PAO.PCREATION_DATE + 9 / 24, 'YYYY/MM/DD') AS CREATION_DATE
	     , TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYY/MM/DD') AS RELEASE_DATE
	     , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_DCS_STATUS, 'S7_DCS_STATUS') AS STATUS
	  FROM INFODBA.PITEM I
	     , INFODBA.PITEMREVISION IR
	     , INFODBA.PWORKSPACEOBJECT PWO
	     , INFODBA.PPOM_APPLICATION_OBJECT PAO
	     , INFODBA.PS7_DESIGNCONCEPTREVISION DCSIR
	     , INFODBA.PS7_DESIGNCONCEPT DCSI
	     , INFODBA.PPOM_USER PU
	     , INFODBA.PPOM_GROUP PG
	     , INFODBA.PUSER U, INFODBA.PPERSON P
	 WHERE DCSI.PUID = I.PUID
	   AND DCSIR.PUID = IR.PUID
	   AND IR.RITEMS_TAGU = I.PUID
	   AND PU.PUID = PAO.ROWNING_USERU
	   AND PG.PUID = PAO.ROWNING_GROUPU
	   AND PU.PUID = U.PUID
	   AND U.RPERSONU = P.PUID
	   AND PAO.PUID = IR.PUID
	   AND PWO.PUID = IR.PUID
	   AND PWO.POBJECT_TYPE IN ('S7_DesignConceptRevision') 
	   AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
	                                  FROM INFODBA.PITEM I1
	                                     , INFODBA.PITEMREVISION IR1
	                                 WHERE IR1.RITEMS_TAGU = I1.PUID
	                                   AND I1.PUID = I.PUID
	                               )
	   AND DCSIR.PS7_DCS_STATUS NOT IN ('Completed')
	   AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR DCSI.PS7_PROJECT_CODE = #{PROJECT_CODE, jdbcType=VARCHAR})
	   AND (#{USER_NAME, jdbcType=VARCHAR} IS NULL OR PU.PUSER_NAME LIKE #{USER_NAME, jdbcType=VARCHAR})
	   AND (#{STATUS, jdbcType=VARCHAR} IS NULL OR DCSIR.PS7_DCS_STATUS LIKE #{STATUS, jdbcType=VARCHAR}) 
	   AND (#{SEARHSCOPE, jdbcType=VARCHAR} = 'ALL' OR #{SEARHSCOPE, jdbcType=VARCHAR} = 'Design Concept') 
 UNION ALL
	SELECT I.PITEM_ID AS DOCUMENT_NO
	     , IR.PITEM_REVISION_ID AS REVISION_NO
	     , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	     , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	     , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	     , ( SELECT MAX(V.TEAM_NAME)
	           FROM INFODBA.PGROUP G1
	              , TEAM_HISTORY V
	          WHERE V.TEAM_CODE = G1.PDESCRIPTION
	            AND G1.PUID = PG.PUID ) AS OWNING_GROUP
	     , PU.PUSER_NAME AS OWNING_USER
	     , PU.PUSER_ID AS OWNING_USER_ID
	     , P.PPA10 AS TEL
	     , PG.PNAME AS OWNING_GROUP1
	     , PAO.ROWNING_USERU AS OWNING_USER_PUID
	     , TO_CHAR(PAO.PCREATION_DATE + 9 / 24, 'YYYY/MM/DD') AS CREATION_DATE
	     , TO_CHAR(PWO.PDATE_RELEASED + 9 / 24, 'YYYY/MM/DD') AS RELEASE_DATE
	     , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_PSC_STATUS, 'S7_PSC_STATUS') AS STATUS
	  FROM INFODBA.PITEM I
	     , INFODBA.PITEMREVISION IR
	     , INFODBA.PWORKSPACEOBJECT PWO
	     , INFODBA.PPOM_APPLICATION_OBJECT PAO
	     , INFODBA.PS7_SYSTEMCONCEPTREVISION DCSIR
	     , INFODBA.PS7_SYSTEMCONCEPT DCSI
	     , INFODBA.PPOM_USER PU
	     , INFODBA.PPOM_GROUP PG
	     , INFODBA.PUSER U, INFODBA.PPERSON P
	 WHERE DCSI.PUID = I.PUID
	   AND DCSIR.PUID = IR.PUID
	   AND IR.RITEMS_TAGU = I.PUID
	   AND PU.PUID = PAO.ROWNING_USERU
	   AND PG.PUID = PAO.ROWNING_GROUPU
	   AND PU.PUID = U.PUID
	   AND U.RPERSONU = P.PUID
	   AND PAO.PUID = IR.PUID
	   AND PWO.PUID = IR.PUID
	   AND PWO.POBJECT_TYPE IN ('S7_SystemConceptRevision') 
	   AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
	                                  FROM INFODBA.PITEM I1
	                                     , INFODBA.PITEMREVISION IR1
	                                 WHERE IR1.RITEMS_TAGU = I1.PUID
	                                   AND I1.PUID = I.PUID
	                               )
	   AND DCSIR.PS7_PSC_STATUS NOT IN ('Completed')
	   AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR DCSI.PS7_PROJECT_CODE = #{PROJECT_CODE, jdbcType=VARCHAR})
	   AND (#{USER_NAME, jdbcType=VARCHAR} IS NULL OR PU.PUSER_NAME LIKE #{USER_NAME, jdbcType=VARCHAR})
	   AND (#{STATUS, jdbcType=VARCHAR} IS NULL OR DCSIR.PS7_PSC_STATUS LIKE #{STATUS, jdbcType=VARCHAR}) 
       AND (#{SEARHSCOPE, jdbcType=VARCHAR} = 'ALL' OR #{SEARHSCOPE, jdbcType=VARCHAR} = 'System Concept') 
  ORDER BY 1, 2
	]]>
	</select>

	<!-- 협의지연관리 -->
	<select id="getConsultationDelayList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN, X.PROJECT_CODE
	     , X.SYSTEM_CODE, X.SYSTEM_NAME
	     , X.CREATION_DATE, X.STATUS
         , X.OWNING_USER, X.OWNING_GROUP
         , X.REVIEWER, X.REVIEWER_GROUP
         , X.DELAY_DAYS
	  FROM (
	        SELECT I.PITEM_ID AS DOCUMENT_NO
	             , IR.PITEM_REVISION_ID AS REVISION_NO
	             , CASE WHEN INSTR(PPJOBW.POBJECT_NAME, '작성부서') > 0 THEN '작성'
	                    WHEN INSTR(PPJOBW.POBJECT_NAME, '협의부서') > 0 THEN '협의' 
	                    WHEN INSTR(PPJOBW.POBJECT_NAME, '참조부서') > 0 THEN '참조'
	                    ELSE ''
	               END AS GUBUN
	             , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	             , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	             , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	             , TO_CHAR(IRPAO.PCREATION_DATE + 9/24, 'YYYY/MM/DD') AS CREATION_DATE 
                 , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_DCS_STATUS, 'S7_DCS_STATUS') AS STATUS
	             , PPET.PUID AS TASK_PUID
                 , CET.PTASK_RESULT
                 , ( SELECT PUSER_NAME FROM INFODBA.PPOM_USER PU1 WHERE PU1.PUID = IRPAO.ROWNING_USERU) AS OWNING_USER
                 , ( SELECT MAX(V.TEAM_NAME)
                     FROM INFODBA.PGROUP G1
                        , TEAM_HISTORY V
                    WHERE V.TEAM_CODE = G1.PDESCRIPTION
                      AND G1.PUID = IRPAO.ROWNING_GROUPU ) AS OWNING_GROUP
                 , PU.PUSER_NAME AS REVIEWER
                 , ( SELECT MAX(V.TEAM_NAME)
                       FROM INFODBA.PGROUP G1
                          , TEAM_HISTORY V
                      WHERE V.TEAM_CODE = G1.PDESCRIPTION
                        AND G1.PUID = PG.PUID ) AS REVIEWER_GROUP
                 , TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_DATE(TO_CHAR(CET.PFND0STARTDATE, 'YYYYMMDD')) AS DELAY_DAYS
                 , CET.PFND0STARTDATE
	          FROM INFODBA.PITEM I
	             , INFODBA.PITEMREVISION IR
	             , INFODBA.PS7_DESIGNCONCEPTREVISION DCSIR
	             , INFODBA.PS7_DESIGNCONCEPT DCSI
	             , INFODBA.PWORKSPACEOBJECT IRW
	             , INFODBA.PPOM_APPLICATION_OBJECT IRPAO
	             , INFODBA.PEPMJOB PPJOB
	             , INFODBA.PWORKSPACEOBJECT PPJOBW
	             , INFODBA.PATTACHMENTS PPATC
	             , INFODBA.PWORKSPACEOBJECT PPETW
	             , INFODBA.PEPMTASK PPET
	             , INFODBA.PEPMTASKTEMPLATE PPETT
	             , INFODBA.PEPMTASK PET
	             , INFODBA.PEPMTASKTEMPLATE PETT
	             , INFODBA.PEPMTASK CET
	             , INFODBA.PEPMTASKTEMPLATE CETT
	             , INFODBA.PATTACHMENTS CATT
	             , INFODBA.PSIGNOFF SO
	             , INFODBA.PPOM_MEMBER PM
	             , INFODBA.PPOM_USER PU
	             , INFODBA.PPOM_GROUP PG
	         WHERE DCSI.PUID = I.PUID
	           AND DCSIR.PUID = IR.PUID
	           AND I.PUID = IR.RITEMS_TAGU
	           AND IRPAO.PUID = IR.PUID
	           AND IRW.PUID = IR.PUID
	           AND IR.PUID = PPATC.PVALU_0
	           AND PPJOBW.PUID = PPJOB.PUID
	           AND PPJOB.PUID = PPET.RPARENT_PROCESSU
	           AND PPATC.PUID = PPET.PUID
	           AND PPETW.PUID = PPET.PUID
	           AND PPETT.PUID = PPET.RTASK_TEMPLATEU
	           AND PPET.PUID = PET.RPARENT_TASKU
	           AND PETT.PUID = PET.RTASK_TEMPLATEU
	           AND PET.PUID = CET.RPARENT_TASKU
	           AND CETT.PUID = CET.RTASK_TEMPLATEU
	           AND CET.PUID = CATT.PUID
	           AND CATT.PVALU_0 = SO.PUID
	           AND SO.RGROUP_MEMBERU = PM.PUID
	           AND PM.RUSERU = PU.PUID
	           AND PM.RGROUPU = PG.PUID
	           AND CETT.PTEMPLATE_NAME = 'perform-signoffs'
	           AND PPETW.POBJECT_NAME LIKE 'SYMC_DCS%'
             AND CET.PTASK_RESULT = 'Unset'
	       ) X
	   WHERE X.GUBUN = '협의'
         AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR UPPER(X.PROJECT_CODE) = #{PROJECT_CODE, jdbcType=VARCHAR})
	     AND (#{SYSTEM_NAME, jdbcType=VARCHAR} IS NULL OR X.SYSTEM_NAME LIKE #{SYSTEM_NAME, jdbcType=VARCHAR})
         AND (#{BEFDIFFDAYS,jdbcType=INTEGER} IS NULL OR X.DELAY_DAYS <= #{BEFDIFFDAYS,jdbcType=INTEGER})
         AND (#{AFTDIFFDAYS,jdbcType=INTEGER} IS NULL OR X.DELAY_DAYS >= #{AFTDIFFDAYS,jdbcType=INTEGER})	
    ORDER BY X.DELAY_DAYS DESC, X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN
	]]>
	</select>
	
	<!-- My DCS List (DCS) -->
	<select id="getMyDCSList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN, X.PROJECT_CODE
	     , X.SYSTEM_CODE, X.SYSTEM_NAME
	     , X.CREATE_DATE
         , X.MAKE_TEAM_NAME
         , X.MAKE_USER, X.MAKE_USER_NAME, X.MAKE_DATE
         , X.FIRST_CREATE_USER, X.FIRST_CREATE_USER_NAME, X.FIRST_CREATE_DATE
         , X.SECOND_CREATE_USER, X.SECOND_CREATE_USER_NAME, X.SECOND_CREATE_DATE
         , X.APPLY_DATE, X.STATUS, X.REVIEW_RESULT
	  FROM (
	        SELECT I.PITEM_ID AS DOCUMENT_NO
	             , IR.PITEM_REVISION_ID AS REVISION_NO
                 , IR.PUID
	             , CASE WHEN MIDOC.WORKFLOW_TYPE = '1' THEN '작성'
	                    WHEN MIDOC.WORKFLOW_TYPE = '2' THEN '협의' 
	                    WHEN MIDOC.WORKFLOW_TYPE = '4' THEN '참조'
	                    ELSE '참조'
	               END AS GUBUN
	             , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
	             , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
	             , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
	             , TO_CHAR(IRPAO.PCREATION_DATE + 9/24, 'YYYY/MM/DD') AS CREATE_DATE 
                 , ( SELECT MAX(MIDOC1.TEAM_NAME) 
                       FROM MIG_PRE_DCS_WORKFLOW MIDOC1 
                      WHERE MIDOC1.DCS_NO = MIDOC.DCS_NO 
                        AND MIDOC1.DCS_REV = MIDOC.DCS_REV 
                        AND MIDOC1.WORKFLOW_TYPE = '1') AS MAKE_TEAM_NAME
                 , MIDOC.MAKE_USER, MIDOC.MAKE_USER_NAME, MIDOC.MAKE_DATE
                 , MIDOC.FIRST_CREATE_USER, MIDOC.FIRST_CREATE_USER_NAME, MIDOC.FIRST_CREATE_DATE
                 , MIDOC.SECOND_CREATE_USER, MIDOC.SECOND_CREATE_USER_NAME, MIDOC.SECOND_CREATE_DATE
                 , TO_CHAR(MIDOC.APPLY_DATE, 'YYYY/MM/DD') AS APPLY_DATE
                 , DCSIR.PS7_DCS_STATUS
                 , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_DCS_STATUS, 'S7_DCS_STATUS') AS STATUS
                 , CASE WHEN MIDOC.REVIEW_RESULT = '0' THEN 'REJECT'
                        WHEN MIDOC.REVIEW_RESULT = '1' THEN 'ACCEPT'
                        WHEN MIDOC.REVIEW_RESULT = '2' THEN 'ACCEPT(S)'
                        ELSE ''
                   END REVIEW_RESULT
	          FROM INFODBA.PITEM I
	             , INFODBA.PITEMREVISION IR
	             , INFODBA.PS7_DESIGNCONCEPTREVISION DCSIR
	             , INFODBA.PS7_DESIGNCONCEPT DCSI
	             , INFODBA.PWORKSPACEOBJECT IRW
                 , INFODBA.PPOM_APPLICATION_OBJECT IRPAO
                 , MIG_PRE_DCS_WORKFLOW MIDOC
	         WHERE DCSI.PUID = I.PUID
	           AND DCSIR.PUID = IR.PUID
	           AND I.PUID = IR.RITEMS_TAGU
               AND IRPAO.PUID = IR.PUID
               AND IRW.PUID = IR.PUID
               AND MIDOC.DCS_NO = I.PITEM_ID
               AND MIDOC.DCS_REV = IR.PITEM_REVISION_ID
               AND ( MIDOC.MAKE_USER = #{USER_ID, jdbcType=VARCHAR}
                  OR MIDOC.FIRST_CREATE_USER = #{USER_ID, jdbcType=VARCHAR}
                  OR MIDOC.SECOND_CREATE_USER = #{USER_ID, jdbcType=VARCHAR})
               AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
                                              FROM INFODBA.PITEMREVISION IR1
                                             WHERE IR1.RITEMS_TAGU = I.PUID )
	       ) X
	   WHERE (#{GUBUN, jdbcType=VARCHAR} = 'ALL' OR X.GUBUN = #{GUBUN, jdbcType=VARCHAR})
	     AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR UPPER(X.PROJECT_CODE) = #{PROJECT_CODE, jdbcType=VARCHAR})
	     AND (#{SYSTEM_NAME, jdbcType=VARCHAR} IS NULL OR X.SYSTEM_NAME LIKE #{SYSTEM_NAME, jdbcType=VARCHAR})
	     AND (#{STATUS, jdbcType=VARCHAR} IS NULL OR X.PS7_DCS_STATUS = #{STATUS, jdbcType=VARCHAR})
    ORDER BY X.DOCUMENT_NO, X.REVISION_NO
	]]>
	</select>
	
	<!-- My DCS List (PSC) -->
	<select id="getMyPSCList" resultType="java.util.HashMap">
	<![CDATA[
	SELECT X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN, X.PROJECT_CODE
	     , X.SYSTEM_CODE, X.SYSTEM_NAME, X.OWNING_GROUP
	     , X.CREATE_DATE, X.STATUS, X.TASK_PUID
	  FROM (
          SELECT I.PITEM_ID AS DOCUMENT_NO
               , IR.PITEM_REVISION_ID AS REVISION_NO
               , IR.PUID
               , '작성' AS GUBUN
               , DCSI.PS7_PROJECT_CODE AS PROJECT_CODE
               , DCSI.PS7_SYSTEM_CODE AS SYSTEM_CODE
               , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSI.PS7_SYSTEM_CODE, 'S7_SYSTEM_CODE') AS SYSTEM_NAME
               , ( SELECT MAX(V.TEAM_NAME)
	                 FROM INFODBA.PGROUP G1
	                    , TEAM_HISTORY V
	                WHERE V.TEAM_CODE = G1.PDESCRIPTION
	                  AND G1.PUID = IRPAO.ROWNING_GROUPU ) AS OWNING_GROUP
               , TO_CHAR(IRPAO.PCREATION_DATE + 9/24, 'YYYY/MM/DD') AS CREATE_DATE 
               , DCSIR.PS7_PSC_STATUS
               , HBOM_CM_PACKAGE.GET_LOV_DESCRIPTION(DCSIR.PS7_PSC_STATUS, 'S7_PSC_STATUS') AS STATUS
               , PPET.PUID AS TASK_PUID
            FROM INFODBA.PITEM I
               , INFODBA.PITEMREVISION IR
               , INFODBA.PS7_SYSTEMCONCEPTREVISION DCSIR
               , INFODBA.PS7_SYSTEMCONCEPT DCSI
               , INFODBA.PWORKSPACEOBJECT IRW
               , INFODBA.PPOM_APPLICATION_OBJECT IRPAO
               , INFODBA.PEPMJOB PPJOB
               , INFODBA.PWORKSPACEOBJECT PPJOBW
               , INFODBA.PATTACHMENTS PPATC
               , INFODBA.PWORKSPACEOBJECT PPETW
               , INFODBA.PEPMTASK PPET
               , INFODBA.PEPMTASKTEMPLATE PPETT
               , INFODBA.PEPMTASK PET
               , INFODBA.PEPMTASKTEMPLATE PETT
               , INFODBA.PEPMTASK CET
               , INFODBA.PEPMTASKTEMPLATE CETT
               , INFODBA.PATTACHMENTS CATT
               , INFODBA.PSIGNOFF SO
               , INFODBA.PPOM_MEMBER PM
               , INFODBA.PPOM_USER PU
           WHERE DCSI.PUID = I.PUID
             AND DCSIR.PUID = IR.PUID
             AND I.PUID = IR.RITEMS_TAGU
             AND IRPAO.PUID = IR.PUID
             AND IRW.PUID = IR.PUID
             AND IR.PUID = PPATC.PVALU_0
             AND PPJOBW.PUID = PPJOB.PUID
             AND PPJOB.PUID = PPET.RPARENT_PROCESSU
             AND PPATC.PUID = PPET.PUID
             AND PPETW.PUID = PPET.PUID
             AND PPETT.PUID = PPET.RTASK_TEMPLATEU
             AND PPET.PUID = PET.RPARENT_TASKU
             AND PETT.PUID = PET.RTASK_TEMPLATEU
             AND PET.PUID = CET.RPARENT_TASKU
             AND CETT.PUID = CET.RTASK_TEMPLATEU
             AND CET.PUID = CATT.PUID
             AND CATT.PVALU_0 = SO.PUID
             AND SO.RGROUP_MEMBERU = PM.PUID
             AND PM.RUSERU = PU.PUID
             AND PPETW.POBJECT_NAME = 'SYMC_PSC'
             AND ( PU.PUSER_ID = #{USER_ID, jdbcType=VARCHAR}
                OR EXISTS ( SELECT 'X'
                              FROM INFODBA.PPOM_USER PU1
                             WHERE PU1.PUSER_ID = #{USER_ID, jdbcType=VARCHAR}
                               AND PU1.PUID = IRPAO.ROWNING_USERU )
                OR EXISTS ( SELECT 'X'
                              FROM INFODBA.PPOM_USER PU2
                                 , INFODBA.PS7_JOINT_WRITER JW2
                             WHERE PU2.PUSER_ID = #{USER_ID, jdbcType=VARCHAR}
                               AND PU2.PUID = JW2.PVALU_0
                               AND JW2.PUID = IR.PUID )
                 )
             AND IR.PITEM_REVISION_ID = ( SELECT MAX(IR1.PITEM_REVISION_ID)
                                            FROM INFODBA.PITEMREVISION IR1
                                           WHERE IR1.RITEMS_TAGU = I.PUID )
	       ) X
	   WHERE (#{GUBUN, jdbcType=VARCHAR} = 'ALL' OR X.GUBUN = #{GUBUN, jdbcType=VARCHAR})
	     AND (#{PROJECT_CODE, jdbcType=VARCHAR} IS NULL OR UPPER(X.PROJECT_CODE) = #{PROJECT_CODE, jdbcType=VARCHAR})
	     AND (#{SYSTEM_NAME, jdbcType=VARCHAR} IS NULL OR X.SYSTEM_NAME LIKE #{SYSTEM_NAME, jdbcType=VARCHAR})
	     AND (#{STATUS, jdbcType=VARCHAR} IS NULL OR X.PS7_PSC_STATUS = #{STATUS, jdbcType=VARCHAR})
GROUP BY X.DOCUMENT_NO, X.REVISION_NO, X.GUBUN, X.PROJECT_CODE
	     , X.SYSTEM_CODE, X.SYSTEM_NAME, X.OWNING_GROUP
	     , X.CREATE_DATE, X.STATUS, X.TASK_PUID
ORDER BY X.DOCUMENT_NO, X.REVISION_NO       
	]]>
	</select>
	
</mapper>
