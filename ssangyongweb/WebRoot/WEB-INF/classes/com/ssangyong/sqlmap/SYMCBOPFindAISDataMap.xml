<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.ssangyong.mapper.SYMCBOPFindAISDataMapper">
	
	<!-- 국문 작업 표준서 검색  2016.09.26  -->
	
	<select id="findKORInstructionSheets" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT KEY_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID,
			EPUB_REV,
			EPUB_STATUS,
			EPUB_DATE,
			EPUB_OP_REV,
			EPUB_REV_PUID
		FROM BOP_FIND_DATA
		WHERE KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
			<!-- Shop Code -->
			<if test="shop_code != null and shop_code != '' ">
			AND SHOP_CODE=#{shop_code, jdbcType=VARCHAR}
			</if>
			<!-- Line Code -->
			<if test="line_code != null and line_code != '' ">
			AND LINE_CODE=#{line_code, jdbcType=VARCHAR}
			</if>
			<!-- Station Code -->
			<if test="station_code != null and station_code != '' ">  
			AND STATION_CODE=#{station_code, jdbcType=VARCHAR}
			</if>
			<!-- Operation Code -->
			<if test="item_id != null and item_id != '' ">
			AND OPERATION_ID LIKE '%'||#{item_id, jdbcType=VARCHAR}||'%'
			</if>
			<!-- Name -->
			<if test="m7_KOR_NAME != null and m7_KOR_NAME != '' ">
			AND ( OPERATION_NAME LIKE '%'||#{m7_KOR_NAME, jdbcType=VARCHAR}||'%'  OR ENGLISH_NAME LIKE '%'||#{m7_KOR_NAME, jdbcType=VARCHAR}||'%' )
			</if>
			<!-- MECO ID -->
			<if test="m7_MECO_NO != null and m7_MECO_NO != '' ">
			AND MECO_ID = #{m7_MECO_NO, jdbcType=VARCHAR}
			</if>
			<!-- MECO Owner -->
			<if test="owning_user != null and owning_user != '' ">
			AND MECO_OWNER_NAME = #{owning_user, jdbcType=VARCHAR}
			</if>
			<!-- Publish User -->
			<if test="publish_user != null and publish_user != '' ">
			AND KPUB_USER= #{publish_user, jdbcType=VARCHAR}
			</if>
			<!-- Released 공법 --> 
			<if test="release_operation != null and release_operation != '' ">
			AND OP_RELEASE_DATE IS NOT NULL
			</if>
			<!-- 미결재 공법 -->
			<if test="norelease_operation != null and norelease_operation != '' ">
			AND KPUB_STATUS IS NULL
			</if>
			<choose>
			<!-- 없는 공법 or 다른 공법-->
			<when test='(empty_operation != null and empty_operation != "")  and (different_operation != null and different_operation != "") '>
			AND (
				KPUB_REV IS NULL
				OR (
					OPERATION_REV <![CDATA[<>]]> KPUB_OP_REV
				)
			)
			</when>
			<!-- 없는 공법 -->
			<when test='(empty_operation != null and empty_operation != "")  and (different_operation == null or  (different_operation != null  and different_operation == "" ))'>
			AND KPUB_REV IS NULL 
			</when>
			<!-- 다른공법 --> 
			<when test='(different_operation != null and different_operation != "")  and (empty_operation == null or (empty_operation != null  and empty_operation == "" ))'>
			AND OPERATION_REV <![CDATA[<>]]> KPUB_OP_REV
			</when>
			</choose>
	</select>
	
	<!-- 영문 작업 표준서 검색  2016.09.26  -->
	
	<select id="findENGInstructionSheets" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT KEY_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID,
			EPUB_REV,
			EPUB_STATUS,
			EPUB_DATE,
			EPUB_OP_REV,
			EPUB_USER,
			EPUB_REV_PUID
		FROM BOP_FIND_DATA
		WHERE KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
			<!-- Shop Code -->
			<if test="shop_code != null and shop_code != '' ">
			AND SHOP_CODE=#{shop_code, jdbcType=VARCHAR}
			</if>
			<!-- Line Code -->
			<if test="line_code != null and line_code != '' ">
			AND LINE_CODE=#{line_code, jdbcType=VARCHAR}
			</if>
			<!-- Station Code -->
			<if test="station_code != null and station_code != '' ">  
			AND STATION_CODE=#{station_code, jdbcType=VARCHAR}
			</if>
			<!-- Operation Code -->
			<if test="item_id != null and item_id != '' ">
			AND OPERATION_ID LIKE '%'||#{item_id, jdbcType=VARCHAR}||'%'
			</if>
			<!-- Name -->
			<if test="m7_KOR_NAME != null and m7_KOR_NAME != '' ">
			AND ( OPERATION_NAME LIKE '%'||#{m7_KOR_NAME, jdbcType=VARCHAR}||'%'  OR ENGLISH_NAME LIKE '%'||#{m7_KOR_NAME, jdbcType=VARCHAR}||'%' )
			</if>
			<!-- MECO ID -->
			<if test="m7_MECO_NO != null and m7_MECO_NO != '' ">
			AND MECO_ID = #{m7_MECO_NO, jdbcType=VARCHAR}
			</if>
			<!-- MECO Owner -->
			<if test="owning_user != null and owning_user != '' ">
			AND MECO_OWNER_NAME = #{owning_user, jdbcType=VARCHAR}
			</if>
			<!-- Publish User -->
			<if test="publish_user != null and publish_user != '' ">
			AND EPUB_USER= #{publish_user, jdbcType=VARCHAR}
			</if>
			<!-- Released 공법 --> 
			<if test="release_operation != null and release_operation != '' ">
			AND OP_RELEASE_DATE IS NOT NULL
			</if>
			<!-- 미결재 공법 -->
            <!--  수정자 : bc.kim 생기팀 김용환 차장 요청 사항  -->
            <!--  미결재 공법 체크박스 체크시 결재상신된 ( 결재 완료 아님 ) 영문작업 표준서도 조회 내용 미포함 요청 -->
            <!--  결재 상신인 경우 PPROCESS_SATAGE_LIST 속성에
                   해당 결재 프로세스와 SIGN-OFF 가 입력됨 결재 완료시에는 지워짐 
                   이때 PPROCESS_STAGE_LIST 테이블에 REVISION 의 PUID가 저장 됨
                   EPUB_REV_PUID 의 값이 PPROCESS_STAGE_LIST 테이블에 존재 하고 해당 PUID 가 BOP_FIND_DATA 테이블에서 제외된 값을 조회-->
			<if test="norelease_operation != null and norelease_operation != '' ">
			AND EPUB_STATUS IS NULL
            AND EPUB_REV IS NOT NULL
            AND EPUB_REV_PUID NOT IN  (( SELECT PUID 
                                           FROM INFODBA.PPROCESS_STAGE_LIST 
                                          WHERE PUID = EPUB_REV_PUID ))
			</if>
			<choose>
			<!-- 없는 공법 and 다른 공법-->
			<when test='(empty_operation != null and empty_operation != "")  and (different_operation != null and different_operation != "") '>
			AND (
				EPUB_OP_REV IS NULL
				OR (
					KPUB_OP_REV <![CDATA[<>]]> EPUB_OP_REV
					OR OPERATION_REV <![CDATA[<>]]> EPUB_OP_REV
				)
			)
			</when>
			<!-- 없는 공법 -->
			<when test='(empty_operation != null and empty_operation != "")  and (different_operation == null or  (different_operation != null  and different_operation == "" ))'>
			AND EPUB_OP_REV IS NULL 
			</when>
			<!-- 다른공법 --> 
			<when test='(different_operation != null and different_operation != "")  and (empty_operation == null or (empty_operation != null  and empty_operation == "" ))'>
			AND (
				EPUB_OP_REV IS NOT NULL
				AND (
					KPUB_OP_REV <![CDATA[<>]]> EPUB_OP_REV
					OR OPERATION_REV <![CDATA[<>]]> EPUB_OP_REV
				)
			)
			</when>
			</choose>
	</select>

	<!-- 국문작업 표준서 검색 Data 생성 2016.09.26 -->

	<insert id="insertKORAssySheetsData" parameterType="java.util.HashMap">
		INSERT INTO BOP_FIND_DATA(
			KEY_CODE,
			VEHICLE_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID
		)
			SELECT DISTINCT BOP_STRUCT_DATA.KEY_CODE AS KEY_CODE,
			    ASSY_OP.VEHICLE_CODE AS VEHICLE_CODE,
				ASSY_OP.SHOP_CODE AS SHOP_CODE,
				PM7_BOPLINEREVISION.PM7_LINE AS LINE_CODE,
				ASSY_OP.STATION_CODE AS STATION_CODE,
				ASSY_OP.OPERATION_CODE AS OPERATION_CODE,
				BOP_STRUCT_DATA.CHILD_ID AS OPERATION_ID,
				BOP_STRUCT_DATA.CHILD_REV AS OPERATION_REV,
				ASSY_OP.KOR_NAME AS OPERATION_NAME,
				DBMS_LOB.SUBSTR (IMAN_MVLBLOB.DATA, 4000, 1) AS OPTION_COND,
				ASSY_OP.MECO_ID AS MECO_ID,
				ASSY_OP.RELEASED_DATE AS OP_RELEASE_DATE,
				ASSY_OP.MECO_OWNER_NAME AS MECO_OWNER_NAME,
		        ASSY_OP.ENG_NAME AS ENGLISH_NAME,
		        BOP_STRUCT_DATA.APP_NODE_PUID AS APP_NODE_PATH_PUID,
		        KPUB_INFO.PITEM_REVISION_ID AS KPUB_REV,
		        KPUB_INFO.STATUS_NAME AS KPUB_STATUS,
		        KPUB_INFO.CREATION_DATE AS KPUB_DATE,
		        KPUB_INFO.PUB_REV AS KPUB_OP_REV,
				KPUB_INFO.PUBLISH_USER AS KPUB_USER,
		        KPUB_INFO.KPS_PUID AS KPUB_REV_PUID
			FROM BOP_STRUCT_DATA, (
					SELECT PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE AS VEHICLE_CODE, 
					    'A'||REPLACE(PM7_BOPOPERATIONREVISION.PM7_SHOP,  #{teamCode,jdbcType=VARCHAR}, '') AS SHOP_CODE,
						PM7_BOPASSYOPREVISION.PM7_STATION_NO AS STATION_CODE,
						PM7_BOPOPERATIONREVISION.PM7_OPERATION_CODE AS OPERATION_CODE,
						MECO_INFO.MECO_ID AS MECO_ID,
						MECO_INFO.OWNING_USER_NAME AS MECO_OWNER_NAME,
						PM7_BOPOPERATIONREVISION.PM7_ENG_NAME AS ENG_NAME,
						PWORKSPACEOBJECT.POBJECT_NAME AS KOR_NAME,
						OP_RELEASE.STATUS_NAME AS STATUS_NAME, 
						OP_RELEASE.RELEASED_DATE AS RELEASED_DATE,
						PITEMREVISION.PUID AS OP_REV_PUID
					FROM INFODBA.PM7_BOPOPERATIONREVISION, 
						INFODBA.PMEOPREVISION,
						INFODBA.PM7_BOPASSYOPREVISION,
						INFODBA.PITEMREVISION,
						INFODBA.PWORKSPACEOBJECT,
						(
							SELECT I.PITEM_ID AS MECO_ID, 
								U1.PUSER_ID AS OWNING_USER_ID, 
								U1.PUSER_NAME AS OWNING_USER_NAME,
								IR.PUID AS MECO_REV_PUID
							FROM INFODBA.PITEM I ,INFODBA.PWORKSPACEOBJECT WO, 
								INFODBA.PITEMREVISION IR, INFODBA.PM7_MECOREVISION ER, 
								INFODBA.PPOM_APPLICATION_OBJECT P, INFODBA.PPOM_USER U1
							WHERE I.PUID = WO.PUID
								AND I.PUID = IR.RITEMS_TAGU
								AND IR.PUID=ER.PUID
								AND P.ROWNING_USERU=U1.PUID
								AND P.PUID=WO.PUID
								AND WO.POBJECT_TYPE = 'M7_MECO'
						) MECO_INFO,
						(
							SELECT DISTINCT
								PITEMREVISION.PUID AS REVISION_PUID,
								PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											PWORKSPACEOBJECT.PDATE_RELEASED,
											(PWORKSPACEOBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PITEMREVISION,
								INFODBA.PITEM,
								INFODBA.PWORKSPACEOBJECT,
								INFODBA.PWORKSPACEOBJECT REVISION_W
							WHERE PITEMREVISION.RITEMS_TAGU = PITEM.PUID
								AND PITEMREVISION.PUID = REVISION_W.PUID
								AND REVISION_W.POBJECT_TYPE IN (
									'M7_BOPAssyOpRevision'
								)
								AND PRELEASESTATUS.PNAME = 'M7_Released'
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID
								AND PRELEASE_STATUS_LIST.PUID = PWORKSPACEOBJECT.PUID
						) OP_RELEASE
					WHERE PM7_BOPOPERATIONREVISION.PUID=PMEOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PUID=PM7_BOPASSYOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PM7_SHOP=#{plantLineCode,jdbcType=VARCHAR}
						AND PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE=#{vehicleCode,jdbcType=VARCHAR}
						AND PITEMREVISION.PUID=PM7_BOPOPERATIONREVISION.PUID
						AND PITEMREVISION.PUID=PWORKSPACEOBJECT.PUID
						AND PMEOPREVISION.RM7_MECO_NOU=MECO_INFO.MECO_REV_PUID(+)
						AND PITEMREVISION.PUID=OP_RELEASE.REVISION_PUID(+)
				) ASSY_OP,
				INFODBA.PM7_BOPLINEREVISION,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							-- 2020-09-07 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
							<if test="release_operation != null and release_operation == 'true'">
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
							</if>
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								-- 2020-09-07 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
								<if test="release_operation != null and release_operation == 'true'">
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								</if>
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) KPUB_INFO,
				INFODBA.IMAN_MVLBLOB
			WHERE BOP_STRUCT_DATA.KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				AND BOP_STRUCT_DATA.CHILD_TYPE IN (
					'M7_BOPAssyOp'
				)
				AND BOP_STRUCT_DATA.REV_PUID=ASSY_OP.OP_REV_PUID
				AND PM7_BOPLINEREVISION.PUID=BOP_STRUCT_DATA.PARENT_REV_PUID
				AND BOP_STRUCT_DATA.CHILD_ID=KPUB_INFO.OPERATION_ID(+) 
				AND BOP_STRUCT_DATA.OCC_PUID=IMAN_MVLBLOB.NAME(+)
	</insert>
	<insert id="insertKORBodySheetsData" parameterType="java.util.HashMap">
		INSERT INTO BOP_FIND_DATA(
			KEY_CODE,
			VEHICLE_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID
		)
			SELECT DISTINCT BOP_STRUCT_DATA.KEY_CODE AS KEY_CODE,
			    BODY_OP.VEHICLE_CODE AS VEHICLE_CODE,
				BODY_OP.SHOP_CODE AS SHOP_CODE,
				BODY_OP.LINE_CODE AS LINE_CODE,
				BODY_OP.STATION_CODE AS STATION_CODE,
				BODY_OP.OPERATION_CODE AS OPERATION_CODE,
				BOP_STRUCT_DATA.CHILD_ID AS OPERATION_ID,
				BOP_STRUCT_DATA.CHILD_REV AS OPERATION_REV,
				BODY_OP.KOR_NAME AS OPERATION_NAME,
				DBMS_LOB.SUBSTR (IMAN_MVLBLOB.DATA, 4000, 1) AS OPTION_COND,
				BODY_OP.MECO_ID AS MECO_ID,
				BODY_OP.RELEASED_DATE AS OP_RELEASE_DATE,
				BODY_OP.MECO_OWNER_NAME AS MECO_OWNER_NAME,
		        BODY_OP.ENG_NAME AS ENGLISH_NAME,
		        BOP_STRUCT_DATA.APP_NODE_PUID AS APP_NODE_PATH_PUID,
		        KPUB_INFO.PITEM_REVISION_ID AS KPUB_REV,
		        KPUB_INFO.STATUS_NAME AS KPUB_STATUS,
		        KPUB_INFO.CREATION_DATE AS KPUB_DATE,
		        KPUB_INFO.PUB_REV AS KPUB_OP_REV,
				KPUB_INFO.PUBLISH_USER AS KPUB_USER,
		        KPUB_INFO.KPS_PUID AS KPUB_REV_PUID
			FROM BOP_STRUCT_DATA,
				(
					SELECT PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE AS VEHICLE_CODE, 
					    PM7_BOPOPERATIONREVISION.PM7_SHOP AS SHOP_CODE,
						PM7_BOPBODYOPREVISION.PM7_LINE AS LINE_CODE,
						PM7_BOPBODYOPREVISION.PM7_STATION_CODE AS STATION_CODE,
						PM7_BOPOPERATIONREVISION.PM7_OPERATION_CODE AS OPERATION_CODE,
						MECO_INFO.MECO_ID AS MECO_ID,
						MECO_INFO.OWNING_USER_NAME AS MECO_OWNER_NAME,
						PM7_BOPOPERATIONREVISION.PM7_ENG_NAME AS ENG_NAME,
						PWORKSPACEOBJECT.POBJECT_NAME AS KOR_NAME,
						OP_RELEASE.STATUS_NAME AS STATUS_NAME, 
						OP_RELEASE.RELEASED_DATE AS RELEASED_DATE,
						PM7_BOPOPERATIONREVISION.PUID AS OP_REV_PUID
					FROM INFODBA.PM7_BOPOPERATIONREVISION, 
						INFODBA.PMEOPREVISION,
						INFODBA.PM7_BOPBODYOPREVISION,
						INFODBA.PITEMREVISION,
						INFODBA.PWORKSPACEOBJECT,
						(
							SELECT I.PITEM_ID AS MECO_ID, 
								U1.PUSER_ID AS OWNING_USER_ID, 
								U1.PUSER_NAME AS OWNING_USER_NAME,
								IR.PUID AS MECO_REV_PUID
							FROM INFODBA.PITEM I ,INFODBA.PWORKSPACEOBJECT WO, 
								INFODBA.PITEMREVISION IR, INFODBA.PM7_MECOREVISION ER, 
								INFODBA.PPOM_APPLICATION_OBJECT P, INFODBA.PPOM_USER U1
							WHERE I.PUID = WO.PUID
								AND I.PUID = IR.RITEMS_TAGU
								AND IR.PUID=ER.PUID
								AND P.ROWNING_USERU=U1.PUID
								AND P.PUID=WO.PUID
								AND WO.POBJECT_TYPE = 'M7_MECO'
						) MECO_INFO,
						(
							SELECT DISTINCT
								PITEMREVISION.PUID AS REVISION_PUID,
								PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											PWORKSPACEOBJECT.PDATE_RELEASED,
											(PWORKSPACEOBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PITEMREVISION,
								INFODBA.PITEM,
								INFODBA.PWORKSPACEOBJECT,
								INFODBA.PWORKSPACEOBJECT REVISION_W
							WHERE PITEMREVISION.RITEMS_TAGU = PITEM.PUID
								AND PITEMREVISION.PUID = REVISION_W.PUID
								AND REVISION_W.POBJECT_TYPE IN (
									'M7_BOPBodyOpRevision'
								)
								AND PRELEASESTATUS.PNAME = 'M7_Released'
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID
								AND PRELEASE_STATUS_LIST.PUID = PWORKSPACEOBJECT.PUID
						) OP_RELEASE
					WHERE PM7_BOPOPERATIONREVISION.PUID=PMEOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PUID=PM7_BOPBODYOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PM7_SHOP=#{plantLineCode,jdbcType=VARCHAR}
						AND PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE=#{vehicleCode,jdbcType=VARCHAR}
						AND PITEMREVISION.PUID=PM7_BOPOPERATIONREVISION.PUID
						AND PITEMREVISION.PUID=PWORKSPACEOBJECT.PUID
						AND PMEOPREVISION.RM7_MECO_NOU=MECO_INFO.MECO_REV_PUID(+)
						AND PITEMREVISION.PUID=OP_RELEASE.REVISION_PUID(+)
				) BODY_OP,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) =#{plantLineCode,jdbcType=VARCHAR}
							-- 2020-09-07 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
							<if test="release_operation != null and release_operation == 'true'">
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
							</if>
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) =#{plantLineCode,jdbcType=VARCHAR}
								-- 2020-09-07 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
								<if test="release_operation != null and release_operation == 'true'">
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								</if>
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) KPUB_INFO,
				INFODBA.IMAN_MVLBLOB
			WHERE BOP_STRUCT_DATA.KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				AND BOP_STRUCT_DATA.CHILD_TYPE IN (
					'M7_BOPBodyOp'
				)
				AND BOP_STRUCT_DATA.REV_PUID=BODY_OP.OP_REV_PUID
				AND BOP_STRUCT_DATA.CHILD_ID=KPUB_INFO.OPERATION_ID(+) 
				AND BOP_STRUCT_DATA.OCC_PUID=IMAN_MVLBLOB.NAME(+)
	</insert>
	<insert id="insertKORPaintSheetsData" parameterType="java.util.HashMap">
		INSERT INTO BOP_FIND_DATA(
			KEY_CODE,
			VEHICLE_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID
		)
			SELECT BOP_STRUCT_DATA.KEY_CODE AS KEY_CODE,
			    PAINT_OP.VEHICLE_CODE AS VEHICLE_CODE,
				PAINT_OP.SHOP_CODE AS SHOP_CODE,
				PAINT_OP.LINE_CODE AS LINE_CODE,
				PAINT_OP.STATION_CODE AS STATION_CODE,
				PAINT_OP.OPERATION_CODE AS OPERATION_CODE,
				BOP_STRUCT_DATA.CHILD_ID AS OPERATION_ID,
				BOP_STRUCT_DATA.CHILD_REV AS OPERATION_REV,
				PAINT_OP.KOR_NAME AS OPERATION_NAME,
				DBMS_LOB.SUBSTR (IMAN_MVLBLOB.DATA, 4000, 1) AS OPTION_COND,
				PAINT_OP.MECO_ID AS MECO_ID,
				PAINT_OP.RELEASED_DATE AS OP_RELEASE_DATE,
				PAINT_OP.MECO_OWNER_NAME AS MECO_OWNER_NAME,
		        PAINT_OP.ENG_NAME AS ENGLISH_NAME,
		        BOP_STRUCT_DATA.APP_NODE_PUID AS APP_NODE_PATH_PUID,
		        KPUB_INFO.PITEM_REVISION_ID AS KPUB_REV,
		        KPUB_INFO.STATUS_NAME AS KPUB_STATUS,
		        KPUB_INFO.CREATION_DATE AS KPUB_DATE,
		        KPUB_INFO.PUB_REV AS KPUB_OP_REV,
				KPUB_INFO.PUBLISH_USER AS KPUB_USER,
		        KPUB_INFO.KPS_PUID AS KPUB_REV_PUID
			FROM BOP_STRUCT_DATA,
				(
					SELECT PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE AS VEHICLE_CODE, 
					    PM7_BOPOPERATIONREVISION.PM7_SHOP AS SHOP_CODE,
						PM7_BOPPAINTOPREVISION.PM7_LINE AS LINE_CODE,
						PM7_BOPPAINTOPREVISION.PM7_STATION_CODE AS STATION_CODE,
						PM7_BOPOPERATIONREVISION.PM7_OPERATION_CODE AS OPERATION_CODE,
						MECO_INFO.MECO_ID AS MECO_ID,
						MECO_INFO.OWNING_USER_NAME AS MECO_OWNER_NAME,
						PM7_BOPOPERATIONREVISION.PM7_ENG_NAME AS ENG_NAME,
						PWORKSPACEOBJECT.POBJECT_NAME AS KOR_NAME,
						OP_RELEASE.STATUS_NAME AS STATUS_NAME, 
						OP_RELEASE.RELEASED_DATE AS RELEASED_DATE,
						PM7_BOPOPERATIONREVISION.PUID AS OP_REV_PUID
					FROM INFODBA.PM7_BOPOPERATIONREVISION, 
						INFODBA.PMEOPREVISION,
						INFODBA.PM7_BOPPAINTOPREVISION,
						INFODBA.PITEMREVISION,
						INFODBA.PWORKSPACEOBJECT,
						(
							SELECT I.PITEM_ID AS MECO_ID, 
								U1.PUSER_ID AS OWNING_USER_ID, 
								U1.PUSER_NAME AS OWNING_USER_NAME,
								IR.PUID AS MECO_REV_PUID
							FROM INFODBA.PITEM I ,INFODBA.PWORKSPACEOBJECT WO, 
								INFODBA.PITEMREVISION IR, INFODBA.PM7_MECOREVISION ER, 
								INFODBA.PPOM_APPLICATION_OBJECT P, INFODBA.PPOM_USER U1
							WHERE I.PUID = WO.PUID
								AND I.PUID = IR.RITEMS_TAGU
								AND IR.PUID=ER.PUID
								AND P.ROWNING_USERU=U1.PUID
								AND P.PUID=WO.PUID
								AND WO.POBJECT_TYPE = 'M7_MECO'
						) MECO_INFO,
						(
							SELECT DISTINCT
								PITEMREVISION.PUID AS REVISION_PUID,
								PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											PWORKSPACEOBJECT.PDATE_RELEASED,
											(PWORKSPACEOBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PITEMREVISION,
								INFODBA.PITEM,
								INFODBA.PWORKSPACEOBJECT,
								INFODBA.PWORKSPACEOBJECT REVISION_W
							WHERE PITEMREVISION.RITEMS_TAGU = PITEM.PUID
								AND PITEMREVISION.PUID = REVISION_W.PUID
								AND REVISION_W.POBJECT_TYPE IN (
									'M7_BOPAssyOpRevision',
									'M7_BOPPaintOpRevision',
									'M7_BOPBodyOpRevision',
									'M7_BOPWeldOPRevision'
								)
								AND PRELEASESTATUS.PNAME = 'M7_Released'
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID
								AND PRELEASE_STATUS_LIST.PUID = PWORKSPACEOBJECT.PUID
						) OP_RELEASE
					WHERE PM7_BOPOPERATIONREVISION.PUID=PMEOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PUID=PM7_BOPPAINTOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PM7_SHOP=#{plantLineCode,jdbcType=VARCHAR}
						AND PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE=#{vehicleCode,jdbcType=VARCHAR}
						AND PITEMREVISION.PUID=PM7_BOPOPERATIONREVISION.PUID
						AND PITEMREVISION.PUID=PWORKSPACEOBJECT.PUID
						AND PMEOPREVISION.RM7_MECO_NOU=MECO_INFO.MECO_REV_PUID(+)
						AND PITEMREVISION.PUID=OP_RELEASE.REVISION_PUID(+)
				) PAINT_OP,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							-- 2020-09-07 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
							<if test="release_operation != null and release_operation == 'true'">
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
							</if>
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								-- 2020-09-07 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
								<if test="release_operation != null and release_operation == 'true'">
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								</if>
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) KPUB_INFO,
				INFODBA.IMAN_MVLBLOB
			WHERE BOP_STRUCT_DATA.KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				AND BOP_STRUCT_DATA.CHILD_TYPE IN (
					'M7_BOPPaintOp'
				)
				AND BOP_STRUCT_DATA.REV_PUID=PAINT_OP.OP_REV_PUID
				AND BOP_STRUCT_DATA.CHILD_ID=KPUB_INFO.OPERATION_ID(+) 
				AND BOP_STRUCT_DATA.OCC_PUID=IMAN_MVLBLOB.NAME(+)
	</insert>
	
	<!-- 영문작업 표준서 검색 Data 생성 2016.09.26 -->
	<!-- [NonSR] 20180207, bc.kim 영문작업 표준서 조회시 내용조회가 되지 않는 경우 발생하여 수정 
                                 조회시 Plant Line Code 가 각각 하드코딩 되있음 - 변수로 변경
   -->
	<insert id="insertENGAssySheetsData" parameterType="java.util.HashMap">
		INSERT INTO BOP_FIND_DATA(
			KEY_CODE,
			VEHICLE_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID,
			EPUB_REV,
			EPUB_STATUS,
			EPUB_DATE,
			EPUB_OP_REV,
			EPUB_USER,
			EPUB_REV_PUID
		)
			SELECT BOP_STRUCT_DATA.KEY_CODE AS KEY_CODE,
			    ASSY_OP.VEHICLE_CODE AS VEHICLE_CODE,
				ASSY_OP.SHOP_CODE AS SHOP_CODE,
				PM7_BOPLINEREVISION.PM7_LINE AS LINE_CODE,
				ASSY_OP.STATION_CODE AS STATION_CODE,
				ASSY_OP.OPERATION_CODE AS OPERATION_CODE,
				BOP_STRUCT_DATA.CHILD_ID AS OPERATION_ID,
				BOP_STRUCT_DATA.CHILD_REV AS OPERATION_REV,
				ASSY_OP.KOR_NAME AS OPERATION_NAME,
				DBMS_LOB.SUBSTR (IMAN_MVLBLOB.DATA, 4000, 1) AS OPTION_COND,
				ASSY_OP.MECO_ID AS MECO_ID,
				ASSY_OP.RELEASED_DATE AS OP_RELEASE_DATE,
				ASSY_OP.MECO_OWNER_NAME AS MECO_OWNER_NAME,
		        ASSY_OP.ENG_NAME AS ENGLISH_NAME,
		        BOP_STRUCT_DATA.APP_NODE_PUID AS APP_NODE_PATH_PUID,
		        KPUB_INFO.PITEM_REVISION_ID AS KPUB_REV,
		        KPUB_INFO.STATUS_NAME AS KPUB_STATUS,
		        KPUB_INFO.CREATION_DATE AS KPUB_DATE,
		        KPUB_INFO.PUB_REV AS KPUB_OP_REV,
				KPUB_INFO.PUBLISH_USER AS KPUB_USER,
		        KPUB_INFO.KPS_PUID AS KPUB_REV_PUID,
		        EPUB_INFO.PITEM_REVISION_ID AS EPUB_REV,
		        EPUB_INFO.STATUS_NAME AS EPUB_STATUS,
		        EPUB_INFO.CREATION_DATE AS EPUB_DATE,
		        EPUB_INFO.PUB_REV AS EPUB_OP_REV,
				EPUB_INFO.PUBLISH_USER AS EPUB_USER,
		        EPUB_INFO.KPS_PUID AS EPUB_REV_PUID
			FROM BOP_STRUCT_DATA, (
					SELECT PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE AS VEHICLE_CODE, 
					    'A'||REPLACE(PM7_BOPOPERATIONREVISION.PM7_SHOP,  #{teamCode,jdbcType=VARCHAR}, '') AS SHOP_CODE,
						PM7_BOPASSYOPREVISION.PM7_STATION_NO AS STATION_CODE,
						PM7_BOPOPERATIONREVISION.PM7_OPERATION_CODE AS OPERATION_CODE,
						MECO_INFO.MECO_ID AS MECO_ID,
						MECO_INFO.OWNING_USER_NAME AS MECO_OWNER_NAME,
						PM7_BOPOPERATIONREVISION.PM7_ENG_NAME AS ENG_NAME,
						PWORKSPACEOBJECT.POBJECT_NAME AS KOR_NAME,
						OP_RELEASE.STATUS_NAME AS STATUS_NAME, 
						OP_RELEASE.RELEASED_DATE AS RELEASED_DATE,
						PITEMREVISION.PUID AS OP_REV_PUID
					FROM INFODBA.PM7_BOPOPERATIONREVISION, 
						INFODBA.PMEOPREVISION,
						INFODBA.PM7_BOPASSYOPREVISION,
						INFODBA.PITEMREVISION,
						INFODBA.PWORKSPACEOBJECT,
						(
							SELECT I.PITEM_ID AS MECO_ID, 
								U1.PUSER_ID AS OWNING_USER_ID, 
								U1.PUSER_NAME AS OWNING_USER_NAME,
								IR.PUID AS MECO_REV_PUID
							FROM INFODBA.PITEM I ,INFODBA.PWORKSPACEOBJECT WO, 
								INFODBA.PITEMREVISION IR, INFODBA.PM7_MECOREVISION ER, 
								INFODBA.PPOM_APPLICATION_OBJECT P, INFODBA.PPOM_USER U1
							WHERE I.PUID = WO.PUID
								AND I.PUID = IR.RITEMS_TAGU
								AND IR.PUID=ER.PUID
								AND P.ROWNING_USERU=U1.PUID
								AND P.PUID=WO.PUID
								AND WO.POBJECT_TYPE = 'M7_MECO'
						) MECO_INFO,
						(
							SELECT DISTINCT
								PITEMREVISION.PUID AS REVISION_PUID,
								PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											PWORKSPACEOBJECT.PDATE_RELEASED,
											(PWORKSPACEOBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PITEMREVISION,
								INFODBA.PITEM,
								INFODBA.PWORKSPACEOBJECT,
								INFODBA.PWORKSPACEOBJECT REVISION_W
							WHERE PITEMREVISION.RITEMS_TAGU = PITEM.PUID
								AND PITEMREVISION.PUID = REVISION_W.PUID
								AND REVISION_W.POBJECT_TYPE IN (
									'M7_BOPAssyOpRevision'
								)
								AND PRELEASESTATUS.PNAME = 'M7_Released'
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID
								AND PRELEASE_STATUS_LIST.PUID = PWORKSPACEOBJECT.PUID
						) OP_RELEASE
					WHERE PM7_BOPOPERATIONREVISION.PUID=PMEOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PUID=PM7_BOPASSYOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PM7_SHOP=#{plantLineCode,jdbcType=VARCHAR}
						AND PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE=#{vehicleCode,jdbcType=VARCHAR}
						AND PITEMREVISION.PUID=PM7_BOPOPERATIONREVISION.PUID
						AND PITEMREVISION.PUID=PWORKSPACEOBJECT.PUID
						AND PMEOPREVISION.RM7_MECO_NOU=MECO_INFO.MECO_REV_PUID(+)
						AND PITEMREVISION.PUID=OP_RELEASE.REVISION_PUID(+)
				) ASSY_OP,
				INFODBA.PM7_BOPLINEREVISION,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							-- 2021-05-25 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
							<if test="release_operation != null and release_operation == 'true'">
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
							</if>
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								-- 2021-05-25 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
								<if test="release_operation != null and release_operation == 'true'">
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								</if>
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) KPUB_INFO,
				INFODBA.IMAN_MVLBLOB,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'EPS'
							--AND SUBSTR(PITEM.PITEM_ID, 8, 2) = '1D' -- 영문작업 표준서 조회시 Plant Line Code 가 하드 코딩 되있음 -> 변수로 수정
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'EPS'
								--AND SUBSTR(PITEM.PITEM_ID, 8, 2) = '1D'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) EPUB_INFO
			WHERE BOP_STRUCT_DATA.KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				AND BOP_STRUCT_DATA.CHILD_TYPE IN (
					'M7_BOPAssyOp'
				)
				AND BOP_STRUCT_DATA.REV_PUID=ASSY_OP.OP_REV_PUID
				AND PM7_BOPLINEREVISION.PUID=BOP_STRUCT_DATA.PARENT_REV_PUID
				AND BOP_STRUCT_DATA.CHILD_ID=KPUB_INFO.OPERATION_ID(+)
				AND BOP_STRUCT_DATA.CHILD_ID=EPUB_INFO.OPERATION_ID(+) 
				AND BOP_STRUCT_DATA.OCC_PUID=IMAN_MVLBLOB.NAME(+)
	</insert>
	
  <!-- [NonSR] 20180207, bc.kim 영문작업 표준서 조회시 내용조회가 되지 않는 경우 발생하여 수정 
                                 조회시 Plant Line Code 가 각각 하드코딩 되있음 - 변수로 변경
   -->
	<insert id="insertENGBodySheetsData" parameterType="java.util.HashMap">
		INSERT INTO BOP_FIND_DATA(
			KEY_CODE,
			VEHICLE_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID,
			EPUB_REV,
			EPUB_STATUS,
			EPUB_DATE,
			EPUB_OP_REV,
			EPUB_USER,
			EPUB_REV_PUID
		)
			SELECT BOP_STRUCT_DATA.KEY_CODE AS KEY_CODE,
			    BODY_OP.VEHICLE_CODE AS VEHICLE_CODE,
				BODY_OP.SHOP_CODE AS SHOP_CODE,
				BODY_OP.LINE_CODE AS LINE_CODE,
				BODY_OP.STATION_CODE AS STATION_CODE,
				BODY_OP.OPERATION_CODE AS OPERATION_CODE,
				BOP_STRUCT_DATA.CHILD_ID AS OPERATION_ID,
				BOP_STRUCT_DATA.CHILD_REV AS OPERATION_REV,
				BODY_OP.KOR_NAME AS OPERATION_NAME,
				DBMS_LOB.SUBSTR (IMAN_MVLBLOB.DATA, 4000, 1) AS OPTION_COND,
				BODY_OP.MECO_ID AS MECO_ID,
				BODY_OP.RELEASED_DATE AS OP_RELEASE_DATE,
				BODY_OP.MECO_OWNER_NAME AS MECO_OWNER_NAME,
		        BODY_OP.ENG_NAME AS ENGLISH_NAME,
		        BOP_STRUCT_DATA.APP_NODE_PUID AS APP_NODE_PATH_PUID,
		        KPUB_INFO.PITEM_REVISION_ID AS KPUB_REV,
		        KPUB_INFO.STATUS_NAME AS KPUB_STATUS,
		        KPUB_INFO.CREATION_DATE AS KPUB_DATE,
		        KPUB_INFO.PUB_REV AS KPUB_OP_REV,
				KPUB_INFO.PUBLISH_USER AS KPUB_USER,
		        KPUB_INFO.KPS_PUID AS KPUB_REV_PUID,
		        EPUB_INFO.PITEM_REVISION_ID AS EPUB_REV,
		        EPUB_INFO.STATUS_NAME AS EPUB_STATUS,
		        EPUB_INFO.CREATION_DATE AS EPUB_DATE,
		        EPUB_INFO.PUB_REV AS EPUB_OP_REV,
				EPUB_INFO.PUBLISH_USER AS EPUB_USER,
		        EPUB_INFO.KPS_PUID AS EPUB_REV_PUID
			FROM BOP_STRUCT_DATA,
				(
					SELECT PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE AS VEHICLE_CODE, 
					    PM7_BOPOPERATIONREVISION.PM7_SHOP AS SHOP_CODE,
						PM7_BOPBODYOPREVISION.PM7_LINE AS LINE_CODE,
						PM7_BOPBODYOPREVISION.PM7_STATION_CODE AS STATION_CODE,
						PM7_BOPOPERATIONREVISION.PM7_OPERATION_CODE AS OPERATION_CODE,
						MECO_INFO.MECO_ID AS MECO_ID,
						MECO_INFO.OWNING_USER_NAME AS MECO_OWNER_NAME,
						PM7_BOPOPERATIONREVISION.PM7_ENG_NAME AS ENG_NAME,
						PWORKSPACEOBJECT.POBJECT_NAME AS KOR_NAME,
						OP_RELEASE.STATUS_NAME AS STATUS_NAME, 
						OP_RELEASE.RELEASED_DATE AS RELEASED_DATE,
						PM7_BOPOPERATIONREVISION.PUID AS OP_REV_PUID
					FROM INFODBA.PM7_BOPOPERATIONREVISION, 
						INFODBA.PMEOPREVISION,
						INFODBA.PM7_BOPBODYOPREVISION,
						INFODBA.PITEMREVISION,
						INFODBA.PWORKSPACEOBJECT,
						(
							SELECT I.PITEM_ID AS MECO_ID, 
								U1.PUSER_ID AS OWNING_USER_ID, 
								U1.PUSER_NAME AS OWNING_USER_NAME,
								IR.PUID AS MECO_REV_PUID
							FROM INFODBA.PITEM I ,INFODBA.PWORKSPACEOBJECT WO, 
								INFODBA.PITEMREVISION IR, INFODBA.PM7_MECOREVISION ER, 
								INFODBA.PPOM_APPLICATION_OBJECT P, INFODBA.PPOM_USER U1
							WHERE I.PUID = WO.PUID
								AND I.PUID = IR.RITEMS_TAGU
								AND IR.PUID=ER.PUID
								AND P.ROWNING_USERU=U1.PUID
								AND P.PUID=WO.PUID
								AND WO.POBJECT_TYPE = 'M7_MECO'
						) MECO_INFO,
						(
							SELECT DISTINCT
								PITEMREVISION.PUID AS REVISION_PUID,
								PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											PWORKSPACEOBJECT.PDATE_RELEASED,
											(PWORKSPACEOBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PITEMREVISION,
								INFODBA.PITEM,
								INFODBA.PWORKSPACEOBJECT,
								INFODBA.PWORKSPACEOBJECT REVISION_W
							WHERE PITEMREVISION.RITEMS_TAGU = PITEM.PUID
								AND PITEMREVISION.PUID = REVISION_W.PUID
								AND REVISION_W.POBJECT_TYPE IN (
									'M7_BOPBodyOpRevision'
								)
								AND PRELEASESTATUS.PNAME = 'M7_Released'
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID
								AND PRELEASE_STATUS_LIST.PUID = PWORKSPACEOBJECT.PUID
						) OP_RELEASE
					WHERE PM7_BOPOPERATIONREVISION.PUID=PMEOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PUID=PM7_BOPBODYOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PM7_SHOP=#{plantLineCode,jdbcType=VARCHAR}
						AND PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE=#{vehicleCode,jdbcType=VARCHAR}
						AND PITEMREVISION.PUID=PM7_BOPOPERATIONREVISION.PUID
						AND PITEMREVISION.PUID=PWORKSPACEOBJECT.PUID
						AND PMEOPREVISION.RM7_MECO_NOU=MECO_INFO.MECO_REV_PUID(+)
						AND PITEMREVISION.PUID=OP_RELEASE.REVISION_PUID(+)
				) BODY_OP,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) =#{plantLineCode,jdbcType=VARCHAR}
							-- 2021-05-25 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
							<if test="release_operation != null and release_operation == 'true'">
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
							</if>
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) =#{plantLineCode,jdbcType=VARCHAR}
								-- 2021-05-25 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
								<if test="release_operation != null and release_operation == 'true'">
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								</if>
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) KPUB_INFO,
				INFODBA.IMAN_MVLBLOB,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'EPS'  -- 영문작업 표준서 조회시 Plant Line Code 가 하드 코딩 되있음 -> 변수로 수정
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'EPS' -- 영문작업 표준서 조회시 Plant Line Code 가 하드 코딩 되있음 -> 변수로 수정
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) EPUB_INFO
			WHERE BOP_STRUCT_DATA.KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				AND BOP_STRUCT_DATA.CHILD_TYPE IN (
					'M7_BOPBodyOp'
				)
				AND BOP_STRUCT_DATA.REV_PUID=BODY_OP.OP_REV_PUID
				AND BOP_STRUCT_DATA.CHILD_ID=KPUB_INFO.OPERATION_ID(+) 
				AND BOP_STRUCT_DATA.CHILD_ID=EPUB_INFO.OPERATION_ID(+)
				AND BOP_STRUCT_DATA.OCC_PUID=IMAN_MVLBLOB.NAME(+)
	</insert>
	
  <!-- [NonSR] 20180207, bc.kim 영문작업 표준서 조회시 내용조회가 되지 않는 경우 발생하여 수정 
                                 조회시 Plant Line Code 가 각각 하드코딩 되있음 - 변수로 변경
   -->
  
	<insert id="insertENGPaintSheetsData" parameterType="java.util.HashMap">
		INSERT INTO BOP_FIND_DATA(
			KEY_CODE,
			VEHICLE_CODE,
			SHOP_CODE,
			LINE_CODE,
			STATION_CODE,
			OPERATION_CODE,
			OPERATION_ID,
			OPERATION_REV,
			OPERATION_NAME,
			OPTION_COND,
			MECO_ID,
			OP_RELEASE_DATE,
			MECO_OWNER_NAME,
			ENGLISH_NAME,
			APP_NODE_PATH_PUID,
			KPUB_REV,
			KPUB_STATUS,
			KPUB_DATE,
			KPUB_OP_REV,
			KPUB_USER,
			KPUB_REV_PUID,
			EPUB_REV,
			EPUB_STATUS,
			EPUB_DATE,
			EPUB_OP_REV,
			EPUB_USER,
			EPUB_REV_PUID
		)
			SELECT BOP_STRUCT_DATA.KEY_CODE AS KEY_CODE,
			    PAINT_OP.VEHICLE_CODE AS VEHICLE_CODE,
				PAINT_OP.SHOP_CODE AS SHOP_CODE,
				PAINT_OP.LINE_CODE AS LINE_CODE,
				PAINT_OP.STATION_CODE AS STATION_CODE,
				PAINT_OP.OPERATION_CODE AS OPERATION_CODE,
				BOP_STRUCT_DATA.CHILD_ID AS OPERATION_ID,
				BOP_STRUCT_DATA.CHILD_REV AS OPERATION_REV,
				PAINT_OP.KOR_NAME AS OPERATION_NAME,
				DBMS_LOB.SUBSTR (IMAN_MVLBLOB.DATA, 4000, 1) AS OPTION_COND,
				PAINT_OP.MECO_ID AS MECO_ID,
				PAINT_OP.RELEASED_DATE AS OP_RELEASE_DATE,
				PAINT_OP.MECO_OWNER_NAME AS MECO_OWNER_NAME,
		        PAINT_OP.ENG_NAME AS ENGLISH_NAME,
		        BOP_STRUCT_DATA.APP_NODE_PUID AS APP_NODE_PATH_PUID,
		        KPUB_INFO.PITEM_REVISION_ID AS KPUB_REV,
		        KPUB_INFO.STATUS_NAME AS KPUB_STATUS,
		        KPUB_INFO.CREATION_DATE AS KPUB_DATE,
		        KPUB_INFO.PUB_REV AS KPUB_OP_REV,
				KPUB_INFO.PUBLISH_USER AS KPUB_USER,
		        KPUB_INFO.KPS_PUID AS KPUB_REV_PUIDD,
		        EPUB_INFO.PITEM_REVISION_ID AS EPUB_REV,
		        EPUB_INFO.STATUS_NAME AS EPUB_STATUS,
		        EPUB_INFO.CREATION_DATE AS EPUB_DATE,
		        EPUB_INFO.PUB_REV AS EPUB_OP_REV,
				EPUB_INFO.PUBLISH_USER AS EPUB_USER,
		        EPUB_INFO.KPS_PUID AS EPUB_REV_PUID
			FROM BOP_STRUCT_DATA,
				(
					SELECT PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE AS VEHICLE_CODE, 
					    PM7_BOPOPERATIONREVISION.PM7_SHOP AS SHOP_CODE,
						PM7_BOPPAINTOPREVISION.PM7_LINE AS LINE_CODE,
						PM7_BOPPAINTOPREVISION.PM7_STATION_CODE AS STATION_CODE,
						PM7_BOPOPERATIONREVISION.PM7_OPERATION_CODE AS OPERATION_CODE,
						MECO_INFO.MECO_ID AS MECO_ID,
						MECO_INFO.OWNING_USER_NAME AS MECO_OWNER_NAME,
						PM7_BOPOPERATIONREVISION.PM7_ENG_NAME AS ENG_NAME,
						PWORKSPACEOBJECT.POBJECT_NAME AS KOR_NAME,
						OP_RELEASE.STATUS_NAME AS STATUS_NAME, 
						OP_RELEASE.RELEASED_DATE AS RELEASED_DATE,
						PM7_BOPOPERATIONREVISION.PUID AS OP_REV_PUID
					FROM INFODBA.PM7_BOPOPERATIONREVISION, 
						INFODBA.PMEOPREVISION,
						INFODBA.PM7_BOPPAINTOPREVISION,
						INFODBA.PITEMREVISION,
						INFODBA.PWORKSPACEOBJECT,
						(
							SELECT I.PITEM_ID AS MECO_ID, 
								U1.PUSER_ID AS OWNING_USER_ID, 
								U1.PUSER_NAME AS OWNING_USER_NAME,
								IR.PUID AS MECO_REV_PUID
							FROM INFODBA.PITEM I ,INFODBA.PWORKSPACEOBJECT WO, 
								INFODBA.PITEMREVISION IR, INFODBA.PM7_MECOREVISION ER, 
								INFODBA.PPOM_APPLICATION_OBJECT P, INFODBA.PPOM_USER U1
							WHERE I.PUID = WO.PUID
								AND I.PUID = IR.RITEMS_TAGU
								AND IR.PUID=ER.PUID
								AND P.ROWNING_USERU=U1.PUID
								AND P.PUID=WO.PUID
								AND WO.POBJECT_TYPE = 'M7_MECO'
						) MECO_INFO,
						(
							SELECT DISTINCT
								PITEMREVISION.PUID AS REVISION_PUID,
								PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											PWORKSPACEOBJECT.PDATE_RELEASED,
											(PWORKSPACEOBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PITEMREVISION,
								INFODBA.PITEM,
								INFODBA.PWORKSPACEOBJECT,
								INFODBA.PWORKSPACEOBJECT REVISION_W
							WHERE PITEMREVISION.RITEMS_TAGU = PITEM.PUID
								AND PITEMREVISION.PUID = REVISION_W.PUID
								AND REVISION_W.POBJECT_TYPE IN (
									'M7_BOPAssyOpRevision',
									'M7_BOPPaintOpRevision',
									'M7_BOPBodyOpRevision',
									'M7_BOPWeldOPRevision'
								)
								AND PRELEASESTATUS.PNAME = 'M7_Released'
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID
								AND PRELEASE_STATUS_LIST.PUID = PWORKSPACEOBJECT.PUID
						) OP_RELEASE
					WHERE PM7_BOPOPERATIONREVISION.PUID=PMEOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PUID=PM7_BOPPAINTOPREVISION.PUID
						AND PM7_BOPOPERATIONREVISION.PM7_SHOP=#{plantLineCode,jdbcType=VARCHAR}
						AND PM7_BOPOPERATIONREVISION.PM7_VEHICLE_CODE=#{vehicleCode,jdbcType=VARCHAR}
						AND PITEMREVISION.PUID=PM7_BOPOPERATIONREVISION.PUID
						AND PITEMREVISION.PUID=PWORKSPACEOBJECT.PUID
						AND PMEOPREVISION.RM7_MECO_NOU=MECO_INFO.MECO_REV_PUID(+)
						AND PITEMREVISION.PUID=OP_RELEASE.REVISION_PUID(+)
				) PAINT_OP,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							-- 2021-05-25 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
							<if test="release_operation != null and release_operation == 'true'">
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
							</if>
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'KPS'
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								-- 2021-05-25 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
								<if test="release_operation != null and release_operation == 'true'">
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
								</if>
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) KPUB_INFO,
				INFODBA.IMAN_MVLBLOB,
				(
					SELECT OPERATION_ID, PUB_REV, PITEM_ID, PITEM_REVISION_ID, PUBLISH_USER, RELEASED_DATE, CREATION_DATE, STATUS_NAME, KPS_PUID
					FROM (
						SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
							SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
							PITEM.PITEM_ID,
							PITEMREVISION.PITEM_REVISION_ID,
							PPOM_USER.PUSER_NAME AS PUBLISH_USER,
							PITEMREVISION.PUID AS KPS_PUID,
							PRELEASESTATUS.PNAME AS STATUS_NAME,
							TO_CHAR (
								NVL2(
										RELEAS_OBJECT.PDATE_RELEASED,
										(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS RELEASED_DATE,
							TO_CHAR (
								NVL2(
										PPOM_APPLICATION_OBJECT.PCREATION_DATE,
										(PPOM_APPLICATION_OBJECT.PCREATION_DATE + 9 / 24),
										NULL
									) , 'YYYY-MM-DD HH24:MI'
							) AS CREATION_DATE
						FROM INFODBA.PITEM,
							INFODBA.PITEMREVISION,
							--INFODBA.PM7_MECOREVISION,
							INFODBA.PWORKSPACEOBJECT, 
							INFODBA.PPOM_APPLICATION_OBJECT,
							INFODBA.PPOM_USER,
							INFODBA.PRELEASE_STATUS_LIST,
							INFODBA.PRELEASESTATUS,
							INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
						WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
							AND PITEM.PUID = PWORKSPACEOBJECT.PUID
							AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
							AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
							AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
							AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'EPS'
							--AND SUBSTR(PITEM.PITEM_ID, 8, 2) = 'P1' -- 영문작업 표준서 조회시 Plant Line Code 가 하드 코딩 되있음 -> 변수로 수정
							AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
							AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
							AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
							AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
							AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
					)
					WHERE (OPERATION_ID, PITEM_ID, PITEM_REVISION_ID) IN (
						SELECT OPERATION_ID, PITEM_ID, MAX(PITEM_REVISION_ID) AS LATEST_REV
						FROM (
							-- PUBLISH (KOR)
							SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
								SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
								PITEM.PITEM_ID,
								PITEMREVISION.PITEM_REVISION_ID,
								PPOM_USER.PUSER_NAME AS PUBLISH_USER,
								PITEMREVISION.PUID AS KPS_PUID,
								--PRELEASESTATUS.PNAME AS STATUS_NAME,
								TO_CHAR (
									NVL2(
											RELEAS_OBJECT.PDATE_RELEASED,
											(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
											NULL
										) , 'YYYY-MM-DD HH24:MI'
								) AS RELEASED_DATE
							FROM INFODBA.PITEM,
								INFODBA.PITEMREVISION,
								--INFODBA.PM7_MECOREVISION,
								INFODBA.PWORKSPACEOBJECT, 
								INFODBA.PPOM_APPLICATION_OBJECT,
								INFODBA.PPOM_USER,
								INFODBA.PRELEASE_STATUS_LIST,
								INFODBA.PRELEASESTATUS,
								INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT
							WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
								AND PITEM.PUID = PWORKSPACEOBJECT.PUID
								AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
								AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
								AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
								AND SUBSTR(PITEM.PITEM_ID, 1, 3) = 'EPS'
								--AND SUBSTR(PITEM.PITEM_ID, 8, 2) = 'P1'-- 영문작업 표준서 조회시 Plant Line Code 가 하드 코딩 되있음 -> 변수로 수정
								AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
								AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
								AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
								AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
								AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
							ORDER BY OPERATION_ID, PUB_REV
						)
						GROUP BY OPERATION_ID, PITEM_ID
					)
				) EPUB_INFO
			WHERE BOP_STRUCT_DATA.KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				AND BOP_STRUCT_DATA.CHILD_TYPE IN (
					'M7_BOPPaintOp'
				)
				AND BOP_STRUCT_DATA.REV_PUID=PAINT_OP.OP_REV_PUID
				AND BOP_STRUCT_DATA.CHILD_ID=KPUB_INFO.OPERATION_ID(+) 
				AND BOP_STRUCT_DATA.CHILD_ID=EPUB_INFO.OPERATION_ID(+)  
				AND BOP_STRUCT_DATA.OCC_PUID=IMAN_MVLBLOB.NAME(+)
	</insert>
	
	<select id="findPublishItemRevListDataXML" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT 
			XMLElement("PubInfo", 
				XMLAttributes(OPERATION_ID AS "Operatoin" , 
					PUB_REV AS "Rev", 
					PUBLISH_USER AS "UserName", 
					RELEASED_DATE AS "ReleasedDate", 
					STATUS_NAME AS "StatusName"), 
				XMLElement("ItemRev", 
					XMLAttributes(ITEM_ID AS "ItemId", 
						REV_ID AS "ItemRevId", 
						PUBLISH_REV_PUID AS "ItemRevPuid")
				) 
			) AS PUB_INFO
		FROM (
			SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
				SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
				PITEM.PITEM_ID AS ITEM_ID,
				PITEMREVISION.PITEM_REVISION_ID AS REV_ID,
				PPOM_USER.PUSER_NAME AS PUBLISH_USER,
				PITEMREVISION.PUID AS PUBLISH_REV_PUID,
				PRELEASESTATUS.PNAME AS STATUS_NAME,
				TO_CHAR (
					NVL2(
							RELEAS_OBJECT.PDATE_RELEASED,
							(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
							NULL
						) , 'YYYY-MM-DD HH24:MI'
				) AS RELEASED_DATE
			FROM INFODBA.PITEM,
				INFODBA.PITEMREVISION,
				--INFODBA.PM7_MECOREVISION,
				INFODBA.PWORKSPACEOBJECT, 
				INFODBA.PPOM_APPLICATION_OBJECT,
				INFODBA.PPOM_USER,
				INFODBA.PRELEASE_STATUS_LIST,
				INFODBA.PRELEASESTATUS,
				INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT,
				(
					SELECT DISTINCT OPERATION_ID AS PART_ID 
					FROM BOP_FIND_DATA 
					WHERE KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				) TARGET_PART
			WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
				AND PITEM.PUID = PWORKSPACEOBJECT.PUID
				AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
				AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
				AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
				AND SUBSTR(PITEM.PITEM_ID, 1, 3) = #{publishSection,jdbcType=VARCHAR}
				AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
				AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
				AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
				AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
				AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
				AND TARGET_PART.PART_ID=SUBSTR (PITEM.PITEM_ID, 5)
			ORDER BY OPERATION_ID, PUB_REV
		)
	</select>

	<select id="findPublishItemRevListDataList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT DISTINCT
			OPERATION_ID     AS OPERATION_ID, 
			PUB_REV             AS OPERATION_REV_ID,
			ITEM_ID              AS PUB_ITEM_ID,
			REV_ID               AS PUB_REV_ID,
			PUBLISH_USER      AS PUB_USER_NAME, 
			STATUS_NAME      AS PUB_STATUS,
			RELEASED_DATE    AS PUB_RELEASED_DATE, 
			PUBLISH_REV_PUID AS PUB_REV_PUID
		FROM (
			SELECT DISTINCT SUBSTR (PITEM.PITEM_ID, 5) AS OPERATION_ID,
				SUBSTR(PITEMREVISION.PITEM_REVISION_ID, 1, 3) AS PUB_REV,
				PITEM.PITEM_ID AS ITEM_ID,
				PITEMREVISION.PITEM_REVISION_ID AS REV_ID,
				PPOM_USER.PUSER_NAME AS PUBLISH_USER,
				PITEMREVISION.PUID AS PUBLISH_REV_PUID,
				PRELEASESTATUS.PNAME AS STATUS_NAME,
				TO_CHAR (
					NVL2(
							RELEAS_OBJECT.PDATE_RELEASED,
							(RELEAS_OBJECT.PDATE_RELEASED + 9 / 24),
							NULL
						) , 'YYYY-MM-DD HH24:MI'
				) AS RELEASED_DATE
			FROM INFODBA.PITEM,
				INFODBA.PITEMREVISION,
				--INFODBA.PM7_MECOREVISION,
				INFODBA.PWORKSPACEOBJECT, 
				INFODBA.PPOM_APPLICATION_OBJECT,
				INFODBA.PPOM_USER,
				INFODBA.PRELEASE_STATUS_LIST,
				INFODBA.PRELEASESTATUS,
				INFODBA.PWORKSPACEOBJECT RELEAS_OBJECT,
				(
					SELECT DISTINCT OPERATION_ID AS PART_ID 
					FROM BOP_FIND_DATA 
					WHERE KEY_CODE=#{findKeyCode,jdbcType=VARCHAR}
				) TARGET_PART
			WHERE PWORKSPACEOBJECT.POBJECT_TYPE = 'M7_ProcessSheet' 
				AND PITEM.PUID = PWORKSPACEOBJECT.PUID
				AND PITEM.PUID = PITEMREVISION.RITEMS_TAGU
				AND PITEMREVISION.PUID = PPOM_APPLICATION_OBJECT.PUID
				AND PPOM_APPLICATION_OBJECT.ROWNING_USERU = PPOM_USER.PUID
				AND SUBSTR(PITEM.PITEM_ID, 1, 3) = #{publishSection,jdbcType=VARCHAR}
				AND SUBSTR(PITEM.PITEM_ID, 8, 2) = #{plantLineCode,jdbcType=VARCHAR}
				-- 2020-09-09 seho 검색 조건에 결재 완료가 체크되어 있을 때 결재 완료 리비전만 검색되도록 수정
				<if test="release_operation != null and release_operation == 'true'">
				AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID
				</if>
				AND PITEMREVISION.PUID = PRELEASE_STATUS_LIST.PUID(+)
				AND PRELEASE_STATUS_LIST.PVALU_0 = PRELEASESTATUS.PUID(+)
				AND PRELEASESTATUS.PNAME(+) = 'M7_Released'
				AND PRELEASE_STATUS_LIST.PUID = RELEAS_OBJECT.PUID(+)
				AND TARGET_PART.PART_ID=SUBSTR (PITEM.PITEM_ID, 5)
			ORDER BY OPERATION_ID, PUB_REV
		)
		ORDER BY OPERATION_ID ASC, PUB_REV_ID ASC
	</select>
	
	<delete id="deleteBeforDatas" parameterType="java.util.HashMap">
		DELETE BOP_FIND_DATA
		WHERE KEY_CODE IN (
			SELECT KEY_CODE
			FROM (
				SELECT KEY_CODE AS KEY_CODE, 
				TO_DATE( SUBSTR(KEY_CODE, (INSTR(KEY_CODE, '_', -1, 1)+1) )  ,'yyyymmddHH24MI') AS CREATE_DATE
				FROM (
					SELECT DISTINCT KEY_CODE
					FROM BOP_FIND_DATA
				)
			)
			WHERE CREATE_DATE <![CDATA[<]]> (SYSDATE - 7) 
		)
	</delete>
</mapper>